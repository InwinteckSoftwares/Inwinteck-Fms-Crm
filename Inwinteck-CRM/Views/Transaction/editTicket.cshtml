@model Inwinteck_CRM.Models.Ticket
@{
    ViewBag.Title = "Edit Ticket || Transaction";
    Layout = "~/Views/Shared/_LayoutTicket.cshtml";
}
@using Newtonsoft.Json
@*@{
        // Generate encrypted URL for the action with the encrypted parameter
        var urlHelper = new UrlHelper(HttpContext.Current.Request.RequestContext);
        string encryptedUrl = urlHelper.Action("editTicket", "Transaction", new { id = UrlEncryptionHelper.Encrypt(Model.Id.ToString()) });
    }
    <a href="@encryptedUrl">Edit Ticket</a>*@
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

<style>

    /* Existing Styles */
    #map_wrapper {
        height: 400px;
    }

    #map_canvas {
        width: 100%;
        height: 100%;
    }

    .cert, .pg, .sc, .cl, .chin, #office_add, #Contact_add, #loadermodel {
        display: none;
    }

    #office_add {
        display: none;
    }

    #Contact_add {
        display: none;
    }

    #loadermodel {
        display: none;
    }

    /* For Message to EU field */
    .hidden {
        display: none;
    }

    #notAvailableCheckbox {
        transform: scale(1.5); /* Adjust the scale factor as needed */
        margin-right: 10px; /* Add some spacing between the checkbox and label */
    }

        /* Add a pointer cursor to indicate clickable */
        #notAvailableCheckbox:hover {
            cursor: pointer;
        }

    .checkbox-label {
        font-weight: bold; /* Make the text bold */
        color: #333; /* Set the text color */
        font-size: 16px; /* Adjust the font size */
        text-transform: uppercase; /* Convert text to uppercase */
        margin-left: 5px; /* Add some spacing between the checkbox and text */
    }

    .wrap-text {
        white-space: normal;
        word-wrap: break-word;
    }

    .resizable-container {
        resize: both;
        overflow: auto;
        padding: 5px;
        border: 1px solid #ccc;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 100%;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
    }

    .dropdown-item {
        padding: 8px 16px;
        cursor: pointer;
    }

        .dropdown-item:hover {
            background-color: #f1f1f1;
        }

    /* ChatApp Edit */
    #chatApp {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 0;
        color: #333;
    }

        #chatApp .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        #chatApp .chat-container {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            max-height: 300px;
            overflow-y: scroll;
            margin-bottom: 20px;
        }

        #chatApp .chat-message {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
            background-color: #e0e0e0;
            max-width: 70%;
        }

            #chatApp .chat-message img,
            #chatApp .chat-message video {
                max-width: 100%;
                border-radius: 5px;
            }

            #chatApp .chat-message.left {
                background-color: #dfe3ee;
                text-align: left;
            }

            #chatApp .chat-message.right {
                background-color: #0073e6;
                color: white;
                text-align: right;
                margin-left: auto;
            }

        #chatApp .form-group {
            margin-bottom: 15px;
        }

            #chatApp .form-group label {
                display: block;
                margin-bottom: 5px;
            }

            #chatApp .form-group input,
            #chatApp .form-group textarea {
                width: 100%;
                padding: 10px;
                border: 1px solid #ccc;
                border-radius: 4px;
            }

            #chatApp .form-group button {
                background-color: #0073e6;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }

    /* New Styles */
    #office_add {
        display: none;
    }

    #Contact_add {
        display: none;
    }

    #loadermodel {
        display: none;
    }

    /* For Message to EU field */
    .hidden {
        display: none;
    }

    #notAvailableCheckbox {
        transform: scale(1.5); /* Adjust the scale factor as needed */
        margin-right: 10px; /* Add some spacing between the checkbox and label */
    }

        /* Add a pointer cursor to indicate clickable */
        #notAvailableCheckbox:hover {
            cursor: pointer;
        }

    .checkbox-label {
        font-weight: bold; /* Make the text bold */
        color: #333; /* Set the text color */
        font-size: 16px; /* Adjust the font size */
        text-transform: uppercase; /* Convert text to uppercase */
        margin-left: 5px; /* Add some spacing between the checkbox and text */
    }

    .wrap-text {
        white-space: normal;
        word-wrap: break-word;
    }

    .resizable-container {
        resize: both;
        overflow: auto;
        padding: 5px;
        border: 1px solid #ccc;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 100%;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
    }

    .dropdown-item {
        padding: 8px 16px;
        cursor: pointer;
    }

        .dropdown-item:hover {
            background-color: #f1f1f1;
        }

    /* ChatApp Edit */
    #chatApp {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 0;
        color: #333;
    }

        #chatApp .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        #chatApp .chat-container {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            max-height: 300px;
            overflow-y: scroll;
            margin-bottom: 20px;
        }

        #chatApp .chat-message {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
            background-color: #e0e0e0;
            max-width: 70%;
        }

            #chatApp .chat-message img,
            #chatApp .chat-message video {
                max-width: 100%;
                border-radius: 5px;
            }

            #chatApp .chat-message.left {
                background-color: #dfe3ee;
                text-align: left;
            }

            #chatApp .chat-message.right {
                background-color: #0073e6;
                color: white;
                text-align: right;
                margin-left: auto;
            }

        #chatApp .form-group {
            margin-bottom: 15px;
        }

            #chatApp .form-group label {
                display: block;
                margin-bottom: 5px;
            }

            #chatApp .form-group input,
            #chatApp .form-group textarea {
                width: 100%;
                padding: 10px;
                border: 1px solid #ccc;
                border-radius: 4px;
            }

            #chatApp .form-group button {
                background-color: #0073e6;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
            }
</style>    


<nav class="pcoded-navbar menupos-fixed menu-light brand-blue">
    <div class="navbar-wrapper">
        <div class="navbar-content scroll-div">
            <ul class="nav pcoded-inner-navbar" style="margin-top: 45%;font-size: 16px;">
                <li class="nav-item active">
                    <a href="#" class="nav-link  text-center has-ripple"><span class="pcoded-mtext">INFO BAR</span></a>
                </li>
                <li class="nav-item">
                    <a href="#Customer" class="nav-link btm-border-left"><span class="pcoded-micon"><i class="fas fa-user-circle"></i></span><span class="pcoded-mtext">Customer</span></a>
                </li>
                <li class="nav-item">
                    <a href="#Ticket" class="nav-link btm-border-left"><span class="pcoded-micon"><i class="fas fa-info-circle"></i></span><span class="pcoded-mtext">Case Details</span></a>
                </li>
                <li class="nav-item">
                    <a href="#Site" class="nav-link btm-border-left"><span class="pcoded-micon"><i class="fas fa-map-marker-alt"></i></span><span class="pcoded-mtext">Site</span></a>
                </li>
                <li class="nav-item">
                    <a href="#FE" class="nav-link btm-border-left"><span class="pcoded-micon"><i class="fas fa-user"></i></span><span class="pcoded-mtext">FE Detail</span></a>
                </li>
                <li class="nav-item">
                    <a href="#Activity" class="nav-link btm-border-left"><span class="pcoded-micon"><i class="fas fa-ticket-alt"></i></span><span class="pcoded-mtext">Activity</span></a>
                </li>
                <li class="nav-item">
                    <button id="initiateChatButton" class="nav-link btm-border-left" style="border: none; background: none; width: 100%; text-align: left; padding: 10px 20px; font-size: 16px; cursor: pointer;">
                        <span class="pcoded-micon"><i class="fas fa-comments"></i></span><span class="pcoded-mtext">Initiate Chat</span>
                    </button>
                </li>
                @*<li class="nav-item">
                        <button id="sendEmailToCustomerButton" class="nav-link btm-border-left" style="border: none; background: none; width: 100%; text-align: left; padding: 10px 20px; font-size: 16px; cursor: pointer;">
                            <span class="pcoded-micon"><i class="bi bi-envelope-arrow-up-fill"></i></span><span class="pcoded-mtext">Send Chat Email</span>
                        </button>
                    </li>*@
                <li class="nav-item">
                    <button id="initiateChatwithSource" class="nav-link btm-border-left" style="border: none; background: none; width: 100%; text-align: left; padding: 10px 20px; font-size: 16px; cursor: pointer;">
                        <span class="pcoded-micon"><i class="fas fa-comments"></i></span><span class="pcoded-mtext">Chat With Source</span>
                    </button>
                </li>
                <li class="nav-item">
                    <button id="sendResponseEmailToCustomerButton" class="nav-link btm-border-left" style="border: none; background: none; width: 100%; text-align: left; padding: 10px 20px; font-size: 16px; cursor: pointer;">
                        <span class="pcoded-micon"><i class="bi bi-envelope-arrow-up-fill"></i></span>
                        <span class="pcoded-mtext">Send Response Email</span>
                    </button>
                </li>
            </ul>

            <h5 class="left-nav">Ticket NO: @Model.Ticket_No</h5>
            @*<h5 class="left-nav">FE Currency: @ViewBag.Currency</h5>*@

        </div>
    </div>
    @*===================Storing Ticket id======================================*@
    <input type="hidden" id="ticketId" value="@Model.Id" name="Id" />

</nav>
<div class="pcoded-main-container">
    <div class="pcoded-wrapper container" style="margin-top: -15px;">
        <div class="pcoded-content-ticket">
            <div class="pcoded-inner-content">
                <div class="main-body">
                    @using (Html.BeginForm("editTicket", "Transaction", FormMethod.Post, new { enctype = "multipart/form-data", role = "form", @class = "col-12" }))
                    {
                        @Html.AntiForgeryToken()
                        @Html.ValidationSummary("", new { @class = "text-danger" })



                        <input type="hidden" id="ticketId" value="@Model.Id" name="Id" />
                        <input type="hidden" value="@Model.CreatedBy" name="CreatedBy">
                        <input type="hidden" value="@Model.CreatedOn" name="CreatedOn">
                        <input type="hidden" value="@Model.Ticket_No" name="Ticket_No">
                        <input type="hidden" value="@Model.EU_Office" name="EU_Office" id="Office">
                        <input type="hidden" class="form-control" value="@Model.EU_ID" name="EU_ID" id="EU_ID">
                        <input type="hidden" class="form-control" value="@Model.Old_Ticket" name="Old_Ticket">
                        <input type="hidden" class="form-control" value="@Model.EmailMessageId" name="EmailMessageId">
                        <input type="hidden" class="form-control" value="@Model.TimeZoneId" name="TimeZoneId" />
                        <input type="hidden" id="firstFEId" value="@Model.FE_ID" />
                        <input type="hidden" id="secondFEId" value="@Model.FE_ID_2  " />
                        <input type="hidden" id="IsSecondFEAvailable" value="@Model.IsSecondFEEnabled  " />

                        <input type="hidden" class="form-control" id="latitude" name="latitude" value="@Model.latitude" placeholder="Latitude" />
                        <input type="hidden" class="form-control" id="longitude" name="longitude" value="@Model.longitude" placeholder="Longitude" />
                        <input type="hidden" class="form-control" id="loggedInUser" name="" value="@ViewBag.UserName" placeholder="" />



                        <div class="container-fluid">

                            <div class="row">
                                <div class="col-md-12">
                                    <!-- Basic Forms -->
                                    <div class="card">

                                        <div class="card shadow-sm mt-4">
                                            <div class="card-header bg-primary">
                                                <h5 class="mb-0" style="color:white"><i class="fas fa-user-circle"></i> Customer Details</h5>
                                                <button type="button" class="btn btn-icon btn-info float-right" id="EUStatus" data-toggle="tooltip" title="View EU Status">
                                                    <i class="fas fa-sign"></i>
                                                </button>
                                            </div>
                                            <div class="card-body">

                                                <!-- Customer and Office -->
                                                <div class="form-row mb-3">
                                                    <label for="EU_ID" class="col-sm-2 col-form-label">
                                                        <i class="fas fa-building"></i> Customer
                                                    </label>
                                                    <div class="col-sm-4">
                                                        <input type="text" class="form-control" value="@ViewBag.Customer" readonly>
                                                    </div>

                                                    <label for="EU_ID" class="col-sm-2 col-form-label">
                                                        <i class="fas fa-briefcase"></i> Office
                                                    </label>
                                                    <div class="col-sm-3">
                                                        <input type="text" class="form-control" value="@ViewBag.EU_Office" readonly>
                                                    </div>

                                                    <div class="col-sm-1 d-flex align-items-center">
                                                        <button type="button" class="btn btn-icon btn-info has-ripple" data-toggle="modal tooltip" data-target="#contact_info" title="View Contact Info">
                                                            <i class="fas fa-user"></i>
                                                        </button>
                                                    </div>
                                                </div>

                                                <!-- Email Subject -->
                                                <div class="form-row mb-3">
                                                    <label for="Email_Subject" class="col-sm-2 col-form-label">
                                                        <i class="fas fa-envelope"></i> Email Subject
                                                    </label>
                                                    <div class="col-md-10">
                                                        <textarea class="form-control" name="Email_Subject" id="Email_Subject" placeholder="Enter your Subject or Leave Blank" readonly style="height: 70px; overflow-y: auto;">@ViewBag.Email_Subject</textarea>
                                                    </div>
                                                </div>

                                                <!-- Customer Auto Mail -->
                                                @*<div class="form-row mb-3">
                                        <label for="email_office" class="col-sm-2 col-form-label">
                                            <i class="fas fa-mail-bulk"></i> Customer  Email
                                        </label>
                                        <div class="col-md-10">
                                            <input type="text" class="form-control" name="email_office" value="@ViewBag.email_office" autocomplete="nope" id="email_office">
                                        </div>
                                    </div>*@



                                            </div>



                                            <!-- /.box-body -->
                                            <div class="modal fade bs-example-modal-lg" id="contact_info" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
                                                <div class="modal-dialog modal-lg">
                                                    <div class="modal-content" style="width: 1080px;margin-left: -10%;">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title" id="myLargeModalLabel">Detail</h4>
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                                                            <div class="spinner-border text-primary" role="status" id="loadermodel">
                                                                <span class="sr-only">Loading...</span>
                                                            </div>
                                                        </div>
                                                        <div class="modal-body">

                                                            <div class="row">

                                                                <div class="col-6">

                                                                    <input type="hidden" name="Contact_ID" id="Contact_ID" value="0" />

                                                                    <div class="form-row">
                                                                        <label for="Website" class="col-sm-4 col-form-label">Person</label>
                                                                        <div class="col-md-8">
                                                                            <input type="text" class="form-control" name="Person" id="Person" placeholder="Enter Contact Person">
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-row">
                                                                        <label for="Email" class="col-sm-4 col-form-label">Designation</label>
                                                                        <div class="col-md-8">
                                                                            <input type="text" class="form-control" name="Designation" id="Designation" placeholder="Enter Contact Designation">
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-row">
                                                                        <label for="Email" class="col-sm-4 col-form-label">Department</label>
                                                                        <div class="col-md-8">
                                                                            <input type="text" class="form-control" name="Department" id="Department" placeholder="Enter Contact Department">
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-row">
                                                                        <label for="Number" class="col-sm-4 col-form-label">Number</label>
                                                                        <div class="col-md-8">
                                                                            <input type="text" class="form-control" name="Number" id="CNumber" placeholder="Enter Office Number">
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-row">
                                                                        <label for="City" class="col-sm-4 col-form-label">Email</label>
                                                                        <div class="col-md-8">
                                                                            <input type="text" class="form-control" name="Email" id="CEmail" placeholder="Enter Office Email">
                                                                        </div>
                                                                    </div>

                                                                    <div class="form-row">
                                                                        <div class="form-group col-md-12 text-center">

                                                                            <input type="button" class="btn btn-primary" value="Add" id="Contact_btn" />
                                                                            <button type="button" title="Add" class="btn btn-link has-ripple" id="Contact_add"><i class="fa fa-plus"></i></button>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="col-sm-6 table-border-style">
                                                                    <div class="table-responsive">
                                                                        <table class="table" id="Office_contact">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>Select</th>
                                                                                    <th>Person</th>
                                                                                    <th>Action</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody></tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            </div>


                                                            <div class="modal-footer text-center">
                                                                <button type="button" class="btn btn-info waves-effect " id="save_value" data-dismiss="modal">Ok</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="card shadow-sm mt-4">
                                            <div class="card-header bg-primary text-white">
                                                <h5 class="mb-0" style="color:white"><i class="fas fa-clipboard-list"></i> Case Details</h5>
                                            </div>
                                            <div class="card-body" id="Ticket">


                                                <!-- Case Mode and Case Type -->
                                                <div class="form-row mb-3">
                                                    <label for="Ticket_Mode" class="col-sm-2 col-form-label">
                                                        <i class="fas fa-cogs"></i> Case Mode
                                                    </label>
                                                    <div class="col-md-4">
                                                        <select class="form-control" name="Ticket_Mode" id="Ticket_Mode" readonly>
                                                            <option value="">Select Case Mode</option>
                                                            @foreach (var i in ViewBag.Ticket_Mode)
                                                            {
                                                                <option value="@i.Value">@i.Text</option>
                                                            }
                                                        </select>
                                                    </div>

                                                    <label for="Ticket_Type" class="col-sm-2 col-form-label">
                                                        <i class="fas fa-tags"></i> Case Type
                                                    </label>
                                                    <div class="col-md-4">
                                                        <select class="form-control" name="Ticket_Type" id="Ticket_Type" readonly>
                                                            <option value="">Select Case Type</option>
                                                            @foreach (var i in ViewBag.Ticket_Type)
                                                            {
                                                                <option value="@i.Value">@i.Text</option>
                                                            }
                                                        </select>
                                                    </div>
                                                </div>

                                                <div class="form-row mb-3">
                                                    <label for="SLA" class="col-sm-2 col-form-label">
                                                        <i class="fas fa-stopwatch"></i> SLA
                                                    </label>
                                                    <div class="col-md-4">
                                                        <select class="form-control" name="SLA" id="SLA">
                                                            <option value="">Select SLA</option>
                                                            @foreach (var i in ViewBag.SLA)
                                                            {
                                                                <option value="@i.Value">@i.Text</option>
                                                            }
                                                        </select>
                                                        @if (Model.Status == 20 || Model.Status == 1414)
                                                        {
                                                            <input type="hidden" name="SLA" value="@Model.SLA" />
                                                        }
                                                    </div>

                                                    <!-- Case No -->
                                                    <label for="Case_No" class="col-sm-2 col-form-label">
                                                        <i class="fas fa-hashtag"></i> Case No
                                                    </label>
                                                    <div class="col-md-4">
                                                        <input type="text" class="form-control" value="@Model.Case_No" name="Case_No" id="Case_No" placeholder="Enter your Case No">
                                                    </div>
                                                </div>


                                                <!-- OEM -->
                                                <div class="form-row mb-3">
                                                    <label for="OEM" class="col-sm-2 col-form-label">
                                                        <i class="fas fa-industry"></i> OEM
                                                        <span data-toggle="tooltip" title="Original equipment manufacturer">
                                                            <i class="fas fa-info-circle"></i>
                                                        </span>
                                                    </label>
                                                    <div class="col-md-4">
                                                        <select class="form-control" name="OEM" id="OEM" readonly>
                                                            <option value="">Select OEM</option>
                                                            @foreach (var i in ViewBag.OEM)
                                                            {
                                                                <option value="@i.Value">@i.Text</option>
                                                            }
                                                        </select>
                                                        @if (Model.Status == 20 || Model.Status == 1414)
                                                        {
                                                            <input type="hidden" name="SLA" value="@Model.SLA" />
                                                        }
                                                    </div>

                                                    <!-- JD -->
                                                    <label class="col-sm-2 col-form-label">
                                                        <i class="fas fa-briefcase"></i> Job Description
                                                    </label>
                                                    <div class="col-md-4">
                                                        <textarea class="form-control wrap-text" name="Scope_Off_Work" readonly>@Model.Scope_Off_Work</textarea>
                                                    </div>
                                                </div>







                                                <!-- Scope of Work -->
                                                <div class="form-row mb-3">
                                                    <label class="col-sm-2 col-form-label">
                                                        <i class="fas fa-briefcase"></i> Scope of Work
                                                    </label>
                                                    <div class="col-md-10" style="height: 100px; overflow-y: auto;">
                                                        <textarea class="form-control wrap-text" name="Job_Description" rows="6" readonly>@Model.Job_Description</textarea>
                                                    </div>
                                                </div>


                                            </div>

                                            <!-- New section heading -->
                                            <div class="card shadow-sm mt-4">
                                                <!-- Card Header -->
                                                <div class="card-header bg-primary text-white">
                                                    <h5 class="mb-0" style="color:white"><i class="fas fa-calendar-alt"></i> Case Dates</h5>
                                                </div>

                                                <!-- Card Body with Date Fields -->
                                                <div class="card-body bg-light p-3 rounded">

                                                    <!-- Case Date (IST) -->
                                                    <div class="form-row align-items-center">
                                                        <div class="col-md-4 mb-3">
                                                            <label for="Ticket_Date" class="col-form-label d-block w-100 text-center">
                                                                <i class="fas fa-calendar-alt"></i> Case Date (IST)
                                                                <span data-toggle="tooltip" title="Date and time in Indian Standard Time">
                                                                    <i class="fas fa-info-circle"></i>
                                                                </span>
                                                            </label>
                                                            @Html.TextBoxFor(m => m.Ticket_Date, "{0:s}", new { @class = "form-control text-center", type = "datetime-local", @readonly = "readonly", id = "CaseDtIndia" })
                                                        </div>

                                                        <!-- Case Date (Local) -->
                                                        <div class="col-md-4 mb-3">
                                                            <label for="LocalTime" id="LocalTimeLabel" class="col-form-label d-block w-100 text-center">
                                                                <i class="fas fa-clock"></i> Case Date (Local)
                                                                <span data-toggle="tooltip" title="Date and time in Case location timezone">
                                                                    <i class="fas fa-info-circle"></i>
                                                                </span>
                                                            </label>
                                                            <input type="datetime-local" class="form-control dateHour text-center" name="CaseDtLocal" value="@ViewBag.CaseDtLocal" id="CaseDtLocal" required readonly>
                                                        </div>

                                                        <!-- Case Date (EST) -->
                                                        <div class="col-md-4 mb-3">
                                                            <label for="USTime" class="col-form-label d-block w-100 text-center">
                                                                <i class="fas fa-globe-americas"></i> Case Date (EST)
                                                                <span data-toggle="tooltip" title="Date and time in Eastern Standard Time">
                                                                    <i class="fas fa-info-circle"></i>
                                                                </span>
                                                            </label>
                                                            <input type="datetime-local" class="form-control dateHour text-center" name="CaseDtUS" value="@ViewBag.CaseDtUs" id="CaseDtUS" required readonly>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>


                                        </div>

                                        <div class="card shadow-sm mt-4">
                                            <div class="card-header bg-primary text-white">
                                                <h5 class="mb-0" style="color:white"><i class="fas fa-map-marker-alt"></i> Site Details</h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-row mb-3">

                                                    <label for="Site_Name" class="col-sm-2 col-form-label">
                                                        <i class="fas fa-map-marker-alt"></i> Site Name
                                                    </label>
                                                    <div class="col-md-4">
                                                        <input type="text" class="form-control" value="@Model.Site_Name" name="Site_Name" id="Site_Name" placeholder="Enter your Site Name" readonly>
                                                    </div>

                                                    <label for="Country" class="col-sm-2 col-form-label">
                                                        <i class="fas fa-flag"></i> Country
                                                    </label>
                                                    <div class="col-md-4">
                                                        <select class="form-control" name="Country" id="Country" readonly>
                                                            <option value="">Select Country</option>
                                                            @foreach (var i in ViewBag.Country)
                                                            {
                                                                <option value="@i.Value">@i.Text</option>
                                                            }
                                                        </select>
                                                    </div>
                                                </div>

                                                <!-- Street Address and Zip/Pin Code -->
                                                <div class="form-row mb-3">
                                                    <label for="Street_Address" class="col-sm-2 col-form-label">
                                                        <i class="fas fa-road"></i> Street Address
                                                    </label>
                                                    <div class="col-md-4">
                                                        <input type="text" class="form-control" value="@Model.Street_Address" name="Street_Address" id="Street_Address" placeholder="Enter your Street Address">
                                                    </div>

                                                    <label for="Zip_Pin_Code" class="col-sm-2 col-form-label">
                                                        <i class="fas fa-mail-bulk"></i> ZipCode/Pincode
                                                    </label>
                                                    <div class="col-md-4">
                                                        <input type="text" class="form-control" value="@Model.Zip_Pin_Code" name="Zip_Pin_Code" id="ZipCode_Pincode" placeholder="Enter your ZipCode/Pincode" readonly>
                                                    </div>
                                                </div>

                                                <!-- City and State -->
                                                <div class="form-row mb-3">
                                                    <label for="City" class="col-sm-2 col-form-label">
                                                        <i class="fas fa-city"></i> City
                                                    </label>
                                                    <div class="col-md-4">
                                                        <input type="text" class="form-control" value="@Model.City" name="City" id="City" placeholder="Enter your City" readonly>
                                                    </div>

                                                    <label for="State" class="col-sm-2 col-form-label">
                                                        <i class="fas fa-map"></i> State
                                                    </label>
                                                    <div class="col-md-4">
                                                        <input type="text" class="form-control" value="@Model.State" name="State" id="State" placeholder="Enter your State" readonly>
                                                    </div>
                                                </div>

                                            </div>


                                            <div class="card shadow-sm mt-4">
                                                <div class="card-header bg-primary text-white">
                                                    <h5 class="mb-0" style="color:white"><i class="fas fa-calendar-alt"></i> Dispatched Dates</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div class="form-row align-items-center">
                                                        <!-- Dispatched Date (IST) -->
                                                        <div class="col-md-4 mb-3">
                                                            <label for="EU_Name" class="col-form-label d-block w-100 text-center">
                                                                <i class="fas fa-clock"></i> Dispatched Date (IST)
                                                                <span data-toggle="tooltip" title="Date and time in Indian Standard Time">
                                                                    <i class="fas fa-info-circle"></i>
                                                                </span>
                                                            </label>
                                                            <input type="datetime-local" name="DispDtIndia" class="form-control dateHour text-center" value="@ViewBag.formattedDispDtIndia" id="DispDtUS" required readonly>
                                                        </div>

                                                        <!-- Dispatched Date (Local) -->
                                                        <div class="col-md-4 mb-3">
                                                            <label for="Dispatch_Date" class="col-form-label d-block w-100 text-center">
                                                                <i class="fas fa-globe"></i> Dispatched Date (Local)
                                                                <span data-toggle="tooltip" title="Date and time in Required Location">
                                                                    <i class="fas fa-info-circle"></i>
                                                                </span>
                                                            </label>
                                                            @Html.TextBoxFor(m => m.Dispatch_Date, "{0:s}", new { @class = "form-control text-center", type = "datetime-local", @readonly = "readonly", id = "Dispatch_Date" })
                                                        </div>

                                                        <!-- Dispatched Date (EST) -->
                                                        <div class="col-md-4 mb-3">
                                                            <label for="EU_Contact" class="col-form-label d-block w-100 text-center">
                                                                <i class="fas fa-clock"></i> Dispatched Date (EST)
                                                                <span data-toggle="tooltip" title="Date and time in Eastern Standard Time">
                                                                    <i class="fas fa-info-circle"></i>
                                                                </span>
                                                            </label>
                                                            <input type="datetime-local" name="DispDtUs" class="form-control dateHour text-center" value="@ViewBag.formattedDispDtUs" id="DispDtUS" required readonly>

                                                        </div>

                                                    </div>

                                                    <!-- Update Button -->
                                                    <div id="updateButtonContainer" class="text-center mt-3" style="display: none;">
                                                        <button type="button" class="btn btn-primary btn-lg" id="updateDispatchDateBtn">
                                                            <i class="fas fa-sync-alt"></i> Update Dispatched DT
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>


                                            <!-- EU Details Section -->
                                            <div class="card shadow-sm mt-4">
                                                <div class="card-header bg-primary text-white">
                                                    <h5 class="mb-0" style="color:white"><i class="fas fa-user"></i> EU Details</h5>
                                                </div>
                                                <div class="card-body">
                                                    <!-- EU Name and EU Contact -->
                                                    <div class="form-row mb-3">
                                                        <label for="EU_Name" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-id-badge"></i> EU Name
                                                        </label>
                                                        <div class="col-md-4">
                                                            <input type="text" class="form-control" value="@Model.EU_Name" autocomplete="nope" name="EU_Name" id="EU_Name" placeholder="Enter your Site Person Name">
                                                        </div>

                                                        <label for="EU_Contact" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-phone"></i> EU Contact
                                                        </label>
                                                        <div class="col-md-4">
                                                            <input type="text" class="form-control" value="@Model.EU_Contact" autocomplete="nope" name="EU_Contact" id="EU_Contact" placeholder="Enter your Site Person Contact">
                                                        </div>
                                                    </div>

                                                    <!-- EU Email and Certification Need -->
                                                    <div class="form-row mb-3">
                                                        <label for="EU_Email" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-envelope"></i> EU Email
                                                        </label>
                                                        <div class="col-md-4">
                                                            <input type="text" class="form-control" value="@Model.EU_Email" autocomplete="nope" name="EU_Email" id="EU_Email" placeholder="Enter your Site Person Email">
                                                        </div>

                                                        <label for="Certification_Need" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-certificate"></i> Certification Need
                                                        </label>
                                                        <div class="col-md-4">
                                                            <select class="form-control" name="Certification_Need" id="Certification_Need">
                                                                <option value="">Select Certification</option>
                                                                <option value="1">Yes</option>
                                                                <option value="0">No</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <!-- Certification Name -->
                                                    <div class="form-row mb-3">
                                                        <label for="Certification_Name" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-award"></i> Certification Name
                                                        </label>
                                                        <div class="col-md-10">
                                                            <select class="js-example-basic-multiple form-control" name="Certification_Name" multiple="multiple" id="Certification">
                                                                @foreach (var i in ViewBag.Certification)
                                                                {
                                                                    <option value="@i.Value">@i.Text</option>
                                                                }
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- TSE Details Section -->
                                            <div class="card shadow-sm mt-4">
                                                <div class="card-header bg-primary text-white">
                                                    <h5 class="mb-0" style="color:white"><i class="fas fa-user-tie"></i> TSE Details</h5>
                                                    <span data-toggle="tooltip" title="Technical Support Engineer">
                                                        <i class="fas fa-info-circle"></i>
                                                    </span>
                                                </div>
                                                <div class="card-body" id="TSENameContainer">
                                                    <!-- TSE Name -->
                                                    <div class="form-row mb-3">
                                                        <label for="TSE_Name" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-user-tie"></i> Case Owner
                                                        </label>
                                                        <div class="col-md-4">
                                                            @Html.TextBoxFor(m => m.TSE_Name, new { @class = "form-control" })
                                                        </div>
                                                        <div class="col-md-1 d-flex align-items-center">
                                                            <button type="button" class="btn btn-success" id="addTSEField">
                                                                <i class="fas fa-plus"></i>
                                                            </button>
                                                        </div>
                                                    </div>

                                                    <!-- TSE Name 2 (Initially Hidden) -->
                                                    @if (!string.IsNullOrEmpty(Model.TSE_Name2))
                                                    {
                                                        <div class="form-row mb-3" id="TSENameField2">
                                                            <label for="TSE_Name2" class="col-sm-2 col-form-label">
                                                                <i class="fas fa-user-tie"></i> TSE Name 2
                                                            </label>
                                                            <div class="col-md-4">
                                                                @Html.TextBoxFor(m => m.TSE_Name2, new { @class = "form-control" })
                                                            </div>
                                                        </div>
                                                    }

                                                    <!-- TSE Name 3 (Initially Hidden) -->
                                                    @if (!string.IsNullOrEmpty(Model.TSE_Name3))
                                                    {
                                                        <div class="form-row mb-3" id="TSENameField3">
                                                            <label for="TSE_Name3" class="col-sm-2 col-form-label">
                                                                <i class="fas fa-user-tie"></i> TSE Name 3
                                                            </label>
                                                            <div class="col-md-4">
                                                                @Html.TextBoxFor(m => m.TSE_Name3, new { @class = "form-control" })
                                                            </div>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <input type="text" id="searchFE" placeholder="Search Field Engineer" class="form-control" style="width: 300px; margin-bottom: 10px;">
                                        </div>


                                        <div id="map_wrapper">
                                            <div id="map_canvas" class="mapping"></div>
                                        </div>



                                        <div class="card shadow-sm mt-4">
                                            <div class="card-header bg-primary text-white">
                                                <h5 class="mb-0" style="color:white"><i class="fas fa-exchange-alt"></i> Additional Change</h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-row m-t-10">
                                                    <!-- Enable 2nd FE -->
                                                    <div class="col-md-6 mb-3">
                                                        <div class="custom-control custom-radio">
                                                            <input type="radio" id="enableSecondFE" name="IsSecondFEEnabled" class="custom-control-input" value="true" @(Model.IsSecondFEEnabled ? "checked" : "")>
                                                            <label class="custom-control-label" for="enableSecondFE">
                                                                <i class="fas fa-user-plus"></i> Enable 2nd FE
                                                            </label>
                                                        </div>
                                                        <div class="custom-control custom-radio">
                                                            <input type="radio" id="disableSecondFE" name="IsSecondFEEnabled" class="custom-control-input" value="false" @(!Model.IsSecondFEEnabled ? "checked" : "")>
                                                            <label class="custom-control-label" for="disableSecondFE">
                                                                <i class="fas fa-user-slash"></i> Disable 2nd FE
                                                            </label>
                                                        </div>
                                                    </div>

                                                    <!-- FE Changed -->
                                                    <div class="col-md-6 mb-3">
                                                        <div class="custom-control custom-radio">
                                                            <input type="radio" id="feChangedYes" name="feChanged" class="custom-control-input" value="true" @(Model.feChanged ? "checked" : "")>
                                                            <label class="custom-control-label" for="feChangedYes">
                                                                <i class="fas fa-exchange-alt"></i> FE Changed - Yes
                                                            </label>
                                                        </div>
                                                        <div class="custom-control custom-radio">
                                                            <input type="radio" id="feChangedNo" name="feChanged" class="custom-control-input" value="false" @(!Model.feChanged ? "checked" : "")>
                                                            <label class="custom-control-label" for="feChangedNo">
                                                                <i class="fas fa-times-circle"></i> FE Changed - No
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card shadow-sm mt-4">
                                            <div class="card-header bg-primary text-white">
                                                <h5 class="mb-0" style="color:white"><i class="fas fa-user-tie"></i> FE Details</h5>
                                                <button type="button" class="btn btn-icon btn-info float-right" id="FEStatus" data-toggle="tooltip" title="View FE Status">
                                                    <i class="fas fa-sign"></i>
                                                </button>
                                            </div>

                                            <div class="card-body" id="FE">

                                                <!-- FE Details Section -->
                                                <div id="feDetailsSection">
                                                    <div class="form-row m-t-10">
                                                        <label for="FE_ID" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-id-badge"></i> FE Name
                                                        </label>
                                                        <div class="col-md-4">
                                                            <select class="form-control" name="FE_ID" id="FE_ID" readonly></select>
                                                        </div>
                                                        <label for="FE_contact" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-phone"></i> Contact
                                                        </label>
                                                        <div class="col-md-4">
                                                            <input type="text" class="form-control" name="FE_contact" id="FE_contact" readonly>
                                                        </div>
                                                    </div>

                                                    <div class="form-row">
                                                        <label for="FE_Email" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-envelope"></i> Email
                                                        </label>
                                                        <div class="col-md-4">
                                                            <input type="text" class="form-control" name="FE_Email" id="FE_Email" readonly>
                                                        </div>
                                                        <label for="FE_Origin" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-map-marker-alt"></i> Origin
                                                        </label>
                                                        <div class="col-md-4">
                                                            <input type="text" class="form-control" name="FE_Origin" id="FE_Origin" readonly>
                                                        </div>
                                                    </div>

                                                    <div class="form-row">
                                                        <label for="FE_Certification" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-certificate"></i> FE Certificates
                                                        </label>
                                                        <div class="col-md-10">
                                                            <textarea class="form-control"
                                                                      rows="5"
                                                                      placeholder="Certification Name"
                                                                      name="FE_Certification"
                                                                      id="FE_Certification"
                                                                      readonly
                                                                      style="height: 200px; overflow-y: auto;">
                                                        </textarea>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Second FE Details Section -->
                                                <div id="secondFEContainer" style="display: none; margin-top: 20px;">
                                                    <div class="form-row">
                                                        <label for="FE_ID_2" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-id-badge"></i> FE Name (2nd)
                                                        </label>
                                                        <div class="col-md-4">
                                                            <select class="form-control" name="FE_ID_2" id="FE_2_ID" readonly></select>
                                                        </div>
                                                        <label for="FE_contact_2" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-phone"></i> Contact (2nd)
                                                        </label>
                                                        <div class="col-md-4">
                                                            <input type="text" class="form-control" name="FE_contact_2" id="FE_2_contact" readonly>
                                                        </div>
                                                    </div>

                                                    <div class="form-row">
                                                        <label for="FE_Email_2" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-envelope"></i> Email (2nd)
                                                        </label>
                                                        <div class="col-md-4">
                                                            <input type="text" class="form-control" name="FE_Email_2" id="FE_2_Email" readonly>
                                                        </div>
                                                        <label for="FE_Origin_2" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-map-marker-alt"></i> Origin (2nd)
                                                        </label>
                                                        <div class="col-md-4">
                                                            <input type="text" class="form-control" name="FE_Origin_2" id="FE_2_Origin" readonly>
                                                        </div>
                                                    </div>

                                                    <div class="form-row">
                                                        <label for="FE_Certification_2" class="col-sm-2 col-form-label">
                                                            <i class="fas fa-certificate"></i> FE Certificates (2nd)
                                                        </label>
                                                        <div class="col-md-10">
                                                            <textarea class="form-control" rows="5" placeholder="Certification Name" name="FE_Certification_2" id="FE_2_Certification" readonly></textarea>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>



                                        @*------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*@
                                    <div class="card-body" id="Activity" style="margin-top: -42px;">
                                        <span class="heading-border">Activity Detail </span>

                                        <div class="form-row m-t-10">
                                            <label for="Ticket_Mode" class="col-sm-2 col-form-label">Ticket Status</label>
                                            <div class="col-md-4">
                                                <select class="form-control" name="Status" id="Status">
                                                    <option value="">Select Status</option>
                                                    @foreach (var i in ViewBag.Status)
                                                    {
                                                        if (i.Value == "1631" || i.Value == "1632")
                                                        {
                                                            <option value="@i.Value" disabled>@i.Text</option>
                                                        }
                                                        else
                                                        {
                                                            <option value="@i.Value">@i.Text</option>
                                                        }
                                                    }
                                                </select>
                                            </div>

                                            <input type="hidden" id="PreviousStatusId" value="@Model.Status" />

                                            @if (Model.Old_Ticket != null)
                                            {
                                                <label for="Ticket_Mode" class="col-sm-2 col-form-label">Old Ticket Number</label>
                                                <div class="col-md-4">
                                                    <input type="text" class="form-control" value="@ViewBag.Old_Ticket" readonly>
                                                </div>
                                            }
                                        </div>

                                        <div class="form-row">
                                            <label for="Reschedule_DT" class="col-sm-2 col-form-label RDT ">Reschedule Date </label>
                                            <div class="col-md-4">
                                                @Html.TextBoxFor(m => m.Reschedule_DT, "{0:s}", new { @class = "form-control RDT", type = "datetime-local" })
                                            </div>

                                            <label for="Reschedule_Reason" class="col-sm-2 col-form-label RDT ">Reschedule Reason </label>
                                            <div class="col-md-4">
                                                <input type="text" class="form-control RDT" name="Reschedule_Reason" value="@Model.Reschedule_Reason">
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <label for="Decline_Reason" class="col-sm-2 col-form-label TDR">Decline Reason</label>
                                            <div class="col-md-10 position-relative">
                                                <!-- Dropdown for decline reason -->
                                                <select class="form-control TDR"
                                                        name="Decline_Reason"
                                                        id="declineReasonDropdown"
                                                        @(string.IsNullOrEmpty(Model.Decline_Reason) ? "" : "disabled")>
                                                    <option value="">Select Decline Reason</option>
                                                    <option value="No FE Available" @(Model.Decline_Reason == "No FE Available" ? "selected" : "")>No FE Available</option>
                                                    <option value="Assign to Different Vender/Lost Job" @(Model.Decline_Reason == "Assign to Different Vender/Lost Job" ? "selected" : "")>Assign to Different Vender/Lost Job</option>
                                                    <option value="Price Issue" @(Model.Decline_Reason == "Price Issue" ? "selected" : "")>Price Issue</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <label for="Cancel_Reason" class="col-sm-2 col-form-label TCR">Cancel Reason</label>
                                            <div class="col-md-4">
                                                <select class="form-control TCR" name="Cancel_Reason" id="Cancel_Reason">
                                                    <option value="">Select Cancel Reason</option>
                                                    @foreach (var i in ViewBag.Cancel_Reason)
                                                    {
                                                        <option value="@i.Value">@i.Text</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>


                                        @*------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*@

                                        <div class="form-row ">
                                            <label class="col-sm-2 col-form-label sc" style="height:50%;">Is Pregame Given ? </label>
                                            <div class="col-md-4">
                                                <select class="form-control sc" name="Pregame" id="Pregame">
                                                    <option value="">Select Pregame</option>
                                                    <option value="1">Yes</option>
                                                    <option value="0">No</option>
                                                </select>
                                            </div>
                                            <label class="col-sm-2 col-form-label pg " style="height:50%;">Pregame File</label>
                                            <div class="col-md-4 pg">
                                                <input type="file" class="dropify" data-default-file="@Model.pregame_upload" name="pht" data-max-file-size="5024K">
                                            </div>
                                        </div>

                                        <div class="form-row ">
                                            <label class="col-sm-2 col-form-label pg">Pregame Description</label>
                                            <div class="col-md-10 pg">
                                                <textarea class="form-control" rows="3" placeholder="Add Pregame Description" autocomplete="nope" name="pregame_detail">@Model.pregame_detail</textarea>
                                            </div>
                                        </div>

                                        @{
                                            bool isSecondFEEnabled = Model.IsSecondFEEnabled;
                                            int status = Model.Status;
                                        }
                                        <div class="card shadow-sm mt-4" id="inTimeContainer">
                                            <div class="card-header bg-primary text-white">
                                                <h5 class="mb-0" style="color:white"><i class="fas fa-clock"></i> In Time</h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-row align-items-center">
                                                    <!-- In Time (IST) -->
                                                    <div class="col-md-4 mb-3">
                                                        <label for="In_Time" class="col-form-label d-block w-100 text-center">
                                                            <i class="fas fa-clock"></i> In Time (IST)
                                                            <span data-toggle="tooltip" title="Date and time in Indian Standard Time">
                                                                <i class="fas fa-info-circle"></i>
                                                            </span>
                                                        </label>
                                                        @Html.TextBoxFor(m => m.In_Time, "{0:s}", new { @class = "form-control text-center", type = "datetime-local", id = "In_Time" })
                                                    </div>



                                                    <!-- In Time (Local) -->
                                                    <div class="col-md-4 mb-3">
                                                        <label for="inTimeLocal" class="col-form-label d-block w-100 text-center">
                                                            <i class="fas fa-globe"></i> In Time (Local)
                                                            <span data-toggle="tooltip" title="Date and time in your local time zone">
                                                                <i class="fas fa-info-circle"></i>
                                                            </span>
                                                        </label>
                                                        @Html.TextBox("inTimeLocal", ViewBag.inTimeLocal as DateTime?, "{0:s}", new { @class = "form-control text-center", type = "datetime-local", @readonly = "readonly", id = "inTimeLocal" })
                                                    </div>

                                                    <!-- In Time (EST) -->
                                                    <div class="col-md-4 mb-3">
                                                        <label for="inTimeUs" class="col-form-label d-block w-100 text-center">
                                                            <i class="fas fa-clock"></i> In Time (EST)
                                                            <span data-toggle="tooltip" title="Date and time in Eastern Standard Time">
                                                                <i class="fas fa-info-circle"></i>
                                                            </span>
                                                        </label>
                                                        @Html.TextBox("inTimeUs", ViewBag.inTimeUs as DateTime?, "{0:s}", new { @class = "form-control text-center", type = "datetime-local", @readonly = "readonly", id = "inTimeUs" })
                                                    </div>



                                                    <!-- Hidden Latitude and Longitude fields -->
                                                    <input type="hidden" class="form-control" id="latitude" name="latitude" value="@Model.latitude" placeholder="Latitude" />
                                                    <input type="hidden" class="form-control" id="longitude" name="longitude" value="@Model.longitude" placeholder="Longitude" />
                                                </div>
                                            </div>
                                        </div>

                                        <div class="card shadow-sm mt-4" id="outTimeContainer">
                                            <div class="card-header bg-primary text-white">
                                                <h5 class="mb-0" style="color:white"><i class="fas fa-clock"></i> Out Time</h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-row align-items-center">
                                                    <!-- Out Time (IST) -->
                                                    <div class="col-md-4 mb-3">
                                                        <label for="Out_Time" class="col-form-label d-block w-100 text-center">
                                                            <i class="fas fa-clock"></i> Out Time (IST)
                                                            <span data-toggle="tooltip" title="Date and time in Indian Standard Time">
                                                                <i class="fas fa-info-circle"></i>
                                                            </span>
                                                        </label>
                                                        @Html.TextBoxFor(m => m.Out_Time, "{0:s}", new { @class = "form-control text-center", type = "datetime-local", id = "Out_Time" })
                                                        <div id="outTimeError" class="text-danger"></div> <!-- Error message for Out Time -->
                                                    </div>


                                                    <!-- Out Time (Local) -->
                                                    <div class="col-md-4 mb-3">
                                                        <label for="OutTimeLocal" class="col-form-label d-block w-100 text-center">
                                                            <i class="fas fa-globe"></i> Out Time (Local)
                                                            <span data-toggle="tooltip" title="Date and time in your local time zone">
                                                                <i class="fas fa-info-circle"></i>
                                                            </span>
                                                        </label>
                                                        @Html.TextBox("OutTimeLocal", ViewBag.OutTimeLocal as DateTime?, "{0:s}", new { @class = "form-control text-center", type = "datetime-local", @readonly = "readonly" })
                                                    </div>

                                                    <!-- Out Time (EST) -->
                                                    <div class="col-md-4 mb-3">
                                                        <label for="OutTimeUs" class="col-form-label d-block w-100 text-center">
                                                            <i class="fas fa-clock"></i> Out Time (EST)
                                                            <span data-toggle="tooltip" title="Date and time in Eastern Standard Time">
                                                                <i class="fas fa-info-circle"></i>
                                                            </span>
                                                        </label>
                                                        @Html.TextBox("OutTimeUs", ViewBag.OutTimeUs as DateTime?, "{0:s}", new { @class = "form-control text-center", type = "datetime-local", @readonly = "readonly" })
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                        @if (Model.IsSecondFEEnabled == true)
                                        {
                                            <div class="card shadow-sm mt-4" id="inTime2ndFE">
                                                <div class="card-header bg-primary text-white">
                                                    <h5 class="mb-0" style="color:white"><i class="fas fa-clock"></i> In Time - 2nd FE</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div class="form-row align-items-center">
                                                        <!-- In Time (IST) - 2nd FE -->
                                                        <div class="col-md-4 mb-3">
                                                            <label for="In_Time2" class="col-form-label d-block w-100 text-center">
                                                                <i class="fas fa-clock"></i> In Time (IST) - 2nd FE
                                                                <span data-toggle="tooltip" title="Date and time in Indian Standard Time">
                                                                    <i class="fas fa-info-circle"></i>
                                                                </span>
                                                            </label>
                                                            @Html.TextBoxFor(m => m.In_Time2, "{0:s}", new { @class = "form-control text-center", type = "datetime-local", id = "In_Time2" })
                                                        </div>

                                                        <!-- In Time (Local) - 2nd FE -->
                                                        <div class="col-md-4 mb-3">
                                                            <label for="inTimeLocal2" class="col-form-label d-block w-100 text-center">
                                                                <i class="fas fa-globe"></i> In Time (Local) - 2nd FE
                                                                <span data-toggle="tooltip" title="Date and time in your local time zone">
                                                                    <i class="fas fa-info-circle"></i>
                                                                </span>
                                                            </label>
                                                            @Html.TextBox("inTimeLocal2", ViewBag.inTimeLocal2 as DateTime?, "{0:s}", new { @class = "form-control text-center", type = "datetime-local", @readonly = "readonly" })
                                                        </div>

                                                        <!-- In Time (EST) - 2nd FE -->
                                                        <div class="col-md-4 mb-3">
                                                            <label for="inTimeUs2" class="col-form-label d-block w-100 text-center">
                                                                <i class="fas fa-clock"></i> In Time (EST) - 2nd FE
                                                                <span data-toggle="tooltip" title="Date and time in Eastern Standard Time">
                                                                    <i class="fas fa-info-circle"></i>
                                                                </span>
                                                            </label>
                                                            @Html.TextBox("inTimeUs2", ViewBag.inTimeUs2 as DateTime?, "{0:s}", new { @class = "form-control text-center", type = "datetime-local", @readonly = "readonly" })
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }


                                        <div class="card shadow-sm mt-4" id="outTime2ndFE" style="display:none">
                                            <div class="card-header bg-primary text-white">
                                                <h5 class="mb-0" style="color:white"><i class="fas fa-clock"></i> Out Time - 2nd FE</h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-row align-items-center">
                                                    <!-- Out Time (IST) - 2nd FE -->
                                                    <div class="col-md-4 mb-3">
                                                        <label for="Out_Time2" class="col-form-label d-block w-100 text-center">
                                                            <i class="fas fa-clock"></i> Out Time (IST) - 2nd FE
                                                            <span data-toggle="tooltip" title="Date and time in Indian Standard Time">
                                                                <i class="fas fa-info-circle"></i>
                                                            </span>
                                                        </label>
                                                        @Html.TextBoxFor(m => m.Out_Time2, "{0:s}", new { @class = "form-control text-center", type = "datetime-local", id = "Out_Time2" })
                                                        <div id="outTime2Error" class="text-danger"></div> <!-- Error message for Out Time 2 -->
                                                    </div>


                                                    <!-- Out Time (Local) - 2nd FE -->
                                                    <div class="col-md-4 mb-3">
                                                        <label for="OutTimeLocal2" class="col-form-label d-block w-100 text-center">
                                                            <i class="fas fa-globe"></i> Out Time (Local) - 2nd FE
                                                            <span data-toggle="tooltip" title="Date and time in your local time zone">
                                                                <i class="fas fa-info-circle"></i>
                                                            </span>
                                                        </label>
                                                        @Html.TextBox("OutTimeLocal2", ViewBag.OutTimeLocal2 as DateTime?, "{0:s}", new { @class = "form-control text-center", type = "datetime-local", @readonly = "readonly" })
                                                    </div>

                                                    <!-- Out Time (EST) - 2nd FE -->
                                                    <div class="col-md-4 mb-3">
                                                        <label for="OutTimeUs2" class="col-form-label d-block w-100 text-center">
                                                            <i class="fas fa-clock"></i> Out Time (EST) - 2nd FE
                                                            <span data-toggle="tooltip" title="Date and time in Eastern Standard Time">
                                                                <i class="fas fa-info-circle"></i>
                                                            </span>
                                                        </label>
                                                        @Html.TextBox("OutTimeUs2", ViewBag.OutTimeUs2 as DateTime?, "{0:s}", new { @class = "form-control text-center", type = "datetime-local", @readonly = "readonly" })
                                                    </div>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="form-row align-items-center" id="totalResolutionTimeLocalContainer" style="display: flex;">
                                            <label class="col-form-label chin" style="margin-right: 10px;">
                                                <i class="fas fa-clock"></i> Total Resolution Time (Local)
                                            </label>
                                            <div style="flex-grow: 1; margin-right: 20px;">
                                                <input type="text" id="totalResolutionTimeLocal" class="form-control chin" readonly="readonly" />
                                            </div>

                                            @if (Model.IsSecondFEEnabled == true)
                                            {
                                                <label class="col-form-label chin" style="margin-right: 10px;">
                                                    <i class="fas fa-user-clock"></i> Total Resolution Time (Local) - 2nd FE
                                                </label>
                                                <div style="flex-grow: 1;">
                                                    <input type="text" id="totalResolutionTimeLocal2" class="form-control chin" readonly="readonly" />
                                                </div>
                                            }
                                        </div>

                                        <div class="card shadow-sm mt-4" id="chargesSentSection">
                                            <div class="row align-items-center mb-3">
                                                @if (Model.TicketFeCharges != null && Model.TicketFeCharges.Count() > 0)
                                                {

                                                    <label for="travelChargesFE1" class="col-sm-2 col-form-label">Travel Charges FE (To Sent)</label>
                                                    <div class="col-sm-10">
                                                        <input type="number"
                                                               id="travelChargesFE1"
                                                               class="form-control"
                                                               min="0"
                                                               step="0.01"
                                                               name="SentTravelCharge"
                                                               value="@Model.TicketFeCharges.FirstOrDefault().SentTravelCharge" />
                                                    </div>
                                                }
                                                else
                                                {
                                            <label for="travelChargesFE1" class="col-sm-2 col-form-label">Travel Charges FE (To Sent)</label>
                                                    <div class="col-sm-10">
                                                        <input type="number"
                                                               id="travelChargesFE1"
                                                               class="form-control"
                                                               min="0"
                                                               step="0.01"
                                                               name="SentTravelCharge"
                                                               value="" />
                                                    </div>
                                                }
                                            </div>

                                            @if (Model.IsSecondFEEnabled)
                                            {
                                                
                                                <div class="row align-items-center mb-3">
                                                    @if (Model.TicketFeCharges != null && Model.TicketFeCharges.Count() > 0)
                                                    {

                                                        <label for="travelChargesFE2" class="col-sm-2 col-form-label">Travel Charges FE2 (To Sent)</label>
                                                        <div class="col-sm-10">
                                                            <input type="number"
                                                                   id="travelChargesFE2"
                                                                   class="form-control"
                                                                   min="0"
                                                                   step="0.01"
                                                                   name="SentTravelCharge2"
                                                                   value="@Model.TicketFeCharges.FirstOrDefault().SentTravelCharge2" />
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                <label for="travelChargesFE2" class="col-sm-2 col-form-label">Travel Charges FE2 (To Sent) </label>
                                                        <div class="col-sm-10">
                                                            <input type="number"
                                                                   id="travelChargesFE2"
                                                                   class="form-control"
                                                                   min="0"
                                                                   step="0.01"
                                                                   name="SentTravelCharge2"
                                                                   value="" />
                                                        </div>
                                                    }
                                                </div>
                                            }
                                        </div>


                                        <div class="form-row cl">
                                            <label class="btn btn-info cl">Add Part</label>
                                            <table class="table table-striped" id="maintable">
                                                <thead class="thead-dark">
                                                    <tr>
                                                        <th>Part Type</th>
                                                        <th>Serial No</th>
                                                        <th>Make Model</th>
                                                        <th>Part Description</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="data-contact-person">
                                                        <td>
                                                            <input type="text" name="IV[0].Part_type" class="form-control f-name01" autocomplete="nope" placeholder="Enter part type" data-toggle="tooltip" title="Specify the type of part" />
                                                        </td>
                                                        <td>
                                                            <input type="text" name="IV[0].Serial_No" class="form-control l-name01" autocomplete="nope" placeholder="Enter serial number" data-toggle="tooltip" title="Enter the part's serial number" />
                                                        </td>
                                                        <td>
                                                            <input type="text" name="IV[0].Make_Model" class="form-control email01" autocomplete="nope" placeholder="Enter make & model" data-toggle="tooltip" title="Provide make and model details" />
                                                        </td>
                                                        <td>
                                                            <input type="text" name="IV[0].Part_Description" class="form-control email02" autocomplete="nope" placeholder="Part description" data-toggle="tooltip" title="Add a description for the part" />
                                                        </td>
                                                        <td>
                                                            <button type="button" id="btnAdd" class="btn btn-xs btn-primary classAdd"><i class="fas fa-plus-circle"></i> Add</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="card shadow-sm p-3 mb-4 bg-white rounded">
                                            @* Part Management and Return Label Section *@
                                            <div class="form-row mb-3">
                                                <label for="Part_Management" class="col-sm-2 col-form-label cl" style="color:white"><i class="fas fa-cogs"></i> Part Management</label>
                                                <div class="col-md-4">
                                                    <select class="form-control cl" name="Part_Management" id="Part_Management">
                                                        <option value="">Select Part Management</option>
                                                        @foreach (var i in ViewBag.Part_Management)
                                                        {
                                                            <option value="@i.Value">@i.Text</option>
                                                        }
                                                    </select>
                                                </div>

                                                <label for="Return_Label" class="col-sm-2 col-form-label pickup"><i class="fas fa-undo-alt"></i> Return Label</label>
                                                <div class="col-md-4">
                                                    <select class="form-control pickup" name="Return_Label" id="Return_Label">
                                                        <option value="">Select Return Label</option>
                                                        <option value="1">Available</option>
                                                        <option value="0">Not Available</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="form-row mb-3">
                                                <label for="Tracking_number" class="col-sm-2 col-form-label pickup-av"><i class="fas fa-barcode"></i> Tracking Number</label>
                                                <div class="col-md-4">
                                                    <input type="text" class="form-control pickup-av" value="@Model.Tracking_number" autocomplete="nope" placeholder="Enter tracking number" name="Tracking_number" id="Tracking_number" />
                                                </div>

                                                <label for="Rl_Reason" class="col-sm-2 col-form-label pickup-nav"><i class="fas fa-info-circle"></i> Reason</label>
                                                <div class="col-md-4">
                                                    <input type="text" class="form-control pickup-nav" value="@Model.Rl_Reason" autocomplete="nope" placeholder="Reason for return" name="Rl_Reason" id="Rl_Reason" />
                                                </div>
                                            </div>
                                        </div>

                                        @* Handover Section *@
                                        <div class="card shadow-sm p-3 mb-4 bg-white rounded">
                                            <div class="form-row mb-3 handover-section">
                                                <label for="Part_Handover" class="col-sm-2 col-form-label handover" style="color:white"><i class="fas fa-handshake"></i> Part Handover</label>
                                                <div class="col-md-4">
                                                    <select class="form-control handover" name="Part_Handover" id="Part_Handover" data-toggle="tooltip" title="Select part handover type">
                                                        <option value="">Select Part Handover</option>
                                                        @foreach (var i in ViewBag.Part_Handover)
                                                        {
                                                            <option value="@i.Value">@i.Text</option>
                                                        }
                                                    </select>
                                                </div>

                                                <label for="ph_Name" class="col-sm-2 col-form-label handover"><i class="fas fa-user"></i> Name</label>
                                                <div class="col-md-4">
                                                    <input type="text" class="form-control handover" value="@Model.ph_Name" autocomplete="nope" placeholder="Enter name" name="ph_Name" id="ph_Name" />
                                                </div>
                                            </div>

                                            <div class="form-row mb-3">
                                                <label for="ph_contact" class="col-sm-2 col-form-label handover"><i class="fas fa-phone"></i> Contact</label>
                                                <div class="col-md-4">
                                                    <input type="text" class="form-control handover" value="@Model.ph_contact" autocomplete="nope" placeholder="Enter contact details" name="ph_contact" id="ph_contact" />
                                                </div>
                                            </div>
                                        </div>

                                        @* Whatsapp Chat Section - Display dynamically *@
                                        <div class="form-group row chin" style="display: none; align-items: center;">
                                            <div style="flex-grow: 1; position: relative;">
                                                <textarea class="form-control" rows="3" placeholder="Add ClosureForm" autocomplete="nope" name="WhatsappChat" id="closureForm" style="width: 100%;"></textarea>
                                                <button type="button" style="position: absolute; bottom: 10px; right: 10px;" id="generateBtn">Generate</button>
                                            </div>
                                        </div>


                                        @*=====================FE charges Section=========================================*@
                                        <div class="card shadow-sm mt-4" id="currencySectionContainer">
                                            <div class="card-header bg-primary text-white">
                                                <h5 class="mb-0" style="color:white"><i class="fas fa-dollar-sign"></i> Currency</h5>
                                            </div>
                                            <div class="card-body">
                                                <!-- Currency Dropdown -->
                                                <div class="form-row m-t-10">
                                                    <label for="Currency" class="col-sm-4 col-form-label">Currency</label>
                                                    <div class="col-sm-8">
                                                        <select class="form-control" id="Currency" name="Currency">
                                                            <option value="">Select Currency</option>
                                                            @foreach (var currency in ViewBag.Currency)
                                                            {
                                                                var selectedCurrency = Model.TicketFeCharges?.FirstOrDefault()?.Currency;
                                                                <option value="@currency.Currency" @(currency.Currency == selectedCurrency ? "selected" : "")>
                                                                    @currency.Country (@currency.Currency)
                                                                </option>
                                                            }
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>




                                        <div class="card shadow-sm mt-4" id="chargesSectionContainer">
                                            <div class="card-header bg-primary text-white">
                                                <h5 class="mb-0" style="color:white"><i class="fas fa-money-bill-wave"></i> Charges (Internal)</h5>
                                            </div>
                                            <div class="card-body" id="">
                                                <input type="hidden" id="Ticket_Id" value="@Model.Id" name="Ticket_Id" />

                                                <!-- First Charges Section -->
                                                <div class="card mb-4">
                                                    <div class="card-header bg-secondary text-white">
                                                        <h6 class="mb-0"><i class="fas fa-wallet"></i> Charges Details</h6>
                                                    </div>
                                                    <div class="card-body charges-section">

                                                        <!-- Travel Charge Dropdown -->
                                                        <div class="form-row m-t-10">
                                                            <label for="TravelCharge" class="col-sm-4 col-form-label">Travel Charge</label>
                                                            <div class="col-sm-8">
                                                                <select class="form-control" name="Travel_Charge_1" id="TravelCharge">
                                                                    <option value="">Select</option>
                                                                    @if (Model.TicketFeCharges != null && Model.TicketFeCharges.Count() > 0)
                                                                    {
                                                                        foreach (var Travel_Charge_1 in new List<SelectListItem>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                                                                new SelectListItem { Text = "Yes", Value = "True" },
                                                                                new SelectListItem { Text = "No", Value = "False" }
                                                                            })
                                                                        {
                                                                            var travelChargeBool = bool.Parse(Travel_Charge_1.Value);
                                                                            var highestIdTicketFeCharge = Model.TicketFeCharges.OrderByDescending(c => c.Id).FirstOrDefault();
                                                                            <option value="@Travel_Charge_1.Value" @(travelChargeBool == highestIdTicketFeCharge?.Travel_Charge_1 ? "selected" : "")>
                                                                                @Travel_Charge_1.Text
                                                                            </option>
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="True">Yes</option>
                                                                        <option value="False">No</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>

                                                        <!-- Travel Amount Input -->
                                                        <div class="form-row m-t-10" id="travelAmountRow">
                                                            <label for="TravelAmount" class="col-sm-4 col-form-label">Travel Amount</label>
                                                            <div class="col-sm-8">
                                                                @if (Model.TicketFeCharges != null && Model.TicketFeCharges.Count() > 0)
                                                                {
                                                                    <input type="number" class="form-control" name="Travel_Amount_1" id="TravelAmount" value="@Model.TicketFeCharges.FirstOrDefault().Travel_Amount_1" />
                                                                }
                                                                else
                                                                {
                                                                    <input type="number" class="form-control" name="Travel_Amount_1" id="TravelAmount" value="" />
                                                                }
                                                            </div>
                                                        </div>


                                                        <!-- Charge Type Dropdown -->
                                                        <div class="form-row m-t-10">
                                                            <label for="ChargeType" class="col-sm-4 col-form-label">Charge Type</label>
                                                            <div class="col-sm-8">
                                                                <select class="form-control" name="Charge_Type_1" id="ChargeType">
                                                                    <option value="">Select</option>
                                                                    @if (Model.TicketFeCharges != null && Model.TicketFeCharges.Count() > 0)
                                                                    {
                                                                        foreach (var Charge_Type_1 in new List<SelectListItem>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                    new SelectListItem { Text = "Per Job", Value = "Per Job" },
                                    new SelectListItem { Text = "Per Hour", Value = "Per Hour" }
                                })
                                                                        {
                                                                            <option value="@Charge_Type_1.Value" @(Charge_Type_1.Value == Model.TicketFeCharges.FirstOrDefault()?.Charge_Type_1 ? "selected" : "")>
                                                                                @Charge_Type_1.Text
                                                                            </option>
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="Per Job">Per Job</option>
                                                                        <option value="Per Hour">Per Hour</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>

                                                        <!-- Per Job Input -->
                                                        <div class="form-row m-t-10" id="perJobRow">
                                                            <label for="PerJob" class="col-sm-4 col-form-label">Per Job</label>
                                                            <div class="col-sm-8">
                                                                @if (Model.TicketFeCharges != null && Model.TicketFeCharges.Count() > 0)
                                                                {
                                                                    <input type="number" class="form-control" name="Per_Job_1" id="PerJob" step="0.01" value="@Model.TicketFeCharges.FirstOrDefault().Per_Job_1" />
                                                                }
                                                                else
                                                                {
                                                                    <input type="number" class="form-control" name="Per_Job_1" id="PerJob" step="0.01" value="" />
                                                                }
                                                            </div>
                                                        </div>

                                                        <!-- Per Hour Input -->
                                                        <div class="form-row m-t-10" id="perHourRow">
                                                            <label for="PerHour" class="col-sm-4 col-form-label">Per Hour</label>
                                                            <div class="col-sm-8">
                                                                @if (Model.TicketFeCharges != null && Model.TicketFeCharges.Count() > 0)
                                                                {
                                                                    <input type="number" class="form-control" name="Per_Hour_1" id="PerHour" step="0.01" value="@Model.TicketFeCharges.FirstOrDefault().Per_Hour_1" />
                                                                }
                                                                else
                                                                {
                                                                    <input type="number" class="form-control" name="Per_Hour_1" id="PerHour" step="0.01" value="" />
                                                                }
                                                            </div>
                                                        </div>


                                                    </div>
                                                </div>

                                                <!-- Second Charges Section (Initially Hidden) -->
                                                <div class="card mb-4" id="secondChargesSection" style="display:none">
                                                    <div class="card-header bg-secondary text-white">
                                                        <h6 class="mb-0"><i class="fas fa-wallet"></i> Charges (2nd FE)</h6>
                                                    </div>
                                                    <div class="card-body charges-section">
                                                        <!-- Travel Charge Dropdown -->
                                                        <div class="form-row m-t-10">
                                                            <label for="TravelCharge2" class="col-sm-4 col-form-label">Travel Charge</label>
                                                            <div class="col-sm-8">
                                                                <select class="form-control" name="Travel_Charge_2" id="TravelCharge2">
                                                                    <option value="">Select</option>
                                                                    @if (Model.TicketFeCharges != null && Model.TicketFeCharges.Count() > 0)
                                                                    {
                                                                        foreach (var Travel_Charge_2 in new List<SelectListItem>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                    new SelectListItem { Text = "Yes", Value = "True" },
                                    new SelectListItem { Text = "No", Value = "False" }
                                })
                                                                        {
                                                                            var travelChargeBool = bool.Parse(Travel_Charge_2.Value);
                                                                            <option value="@Travel_Charge_2.Value" @(travelChargeBool == Model.TicketFeCharges.FirstOrDefault()?.Travel_Charge_2 ? "selected" : "")>
                                                                                @Travel_Charge_2.Text
                                                                            </option>
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="True">Yes</option>
                                                                        <option value="False">No</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>


                                                        <!-- Travel Amount Input 2 -->
                                                        <div class="form-row m-t-10" id="travelAmountRow2">
                                                            <label for="TravelAmount2" class="col-sm-4 col-form-label">Travel Amount 2</label>
                                                            <div class="col-sm-8">
                                                                @if (Model.TicketFeCharges != null && Model.TicketFeCharges.Count() > 0)
                                                                {
                                                                    <input type="number" class="form-control" name="Travel_Amount_2" id="TravelAmount2" step="0.01" value="@Model.TicketFeCharges.FirstOrDefault().Travel_Amount_2" />
                                                                }
                                                                else
                                                                {
                                                                    <input type="number" class="form-control" name="Travel_Amount_2" id="TravelAmount2" step="0.01" value="" />
                                                                }
                                                            </div>
                                                        </div>


                                                        <!-- Charge Type Dropdown -->
                                                        <div class="form-row m-t-10">
                                                            <label for="ChargeType2" class="col-sm-4 col-form-label">Charge Type</label>
                                                            <div class="col-sm-8">
                                                                <select class="form-control" name="Charge_Type_2" id="ChargeType2">
                                                                    <option value="">Select</option>
                                                                    @if (Model.TicketFeCharges != null && Model.TicketFeCharges.Count() > 0)
                                                                    {
                                                                        foreach (var Charge_Type_2 in new List<SelectListItem>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                    new SelectListItem { Text = "Per Job", Value = "Per Job" },
                                    new SelectListItem { Text = "Per Hour", Value = "Per Hour" }
                                })
                                                                        {
                                                                            <option value="@Charge_Type_2.Value" @(Charge_Type_2.Value == Model.TicketFeCharges.FirstOrDefault()?.Charge_Type_2 ? "selected" : "")>
                                                                                @Charge_Type_2.Text
                                                                            </option>
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="Per Job">Per Job</option>
                                                                        <option value="Per Hour">Per Hour</option>
                                                                    }
                                                                </select>
                                                            </div>
                                                        </div>

                                                        <!-- Per Job Input -->
                                                        <div class="form-row m-t-10" id="perJobRow2">
                                                            <label for="PerJob2" class="col-sm-4 col-form-label">Per Job</label>
                                                            <div class="col-sm-8">
                                                                @if (Model.TicketFeCharges != null && Model.TicketFeCharges.Count() > 0)
                                                                {
                                                                    <input type="number" class="form-control" name="Per_Job_2" id="PerJob2" step="0.01" value="@Model.TicketFeCharges.FirstOrDefault().Per_Job_2" />
                                                                }
                                                                else
                                                                {
                                                                    <input type="number" class="form-control" name="Per_Job_2" id="PerJob2" step="0.01" value="" />
                                                                }
                                                            </div>
                                                        </div>

                                                        <!-- Per Hour Input -->
                                                        <div class="form-row m-t-10" id="perHourRow2">
                                                            <label for="PerHour2" class="col-sm-4 col-form-label">Per Hour</label>
                                                            <div class="col-sm-8">
                                                                @if (Model.TicketFeCharges != null && Model.TicketFeCharges.Count() > 0)
                                                                {
                                                                    <input type="number" class="form-control" name="Per_Hour_2" id="PerHour2" step="0.01" value="@Model.TicketFeCharges.FirstOrDefault().Per_Hour_2" />
                                                                }
                                                                else
                                                                {
                                                                    <input type="number" class="form-control" name="Per_Hour_2" id="PerHour2" step="0.01" value="" />
                                                                }
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>


                                        @*=====================FE charges Section End=========================================*@

                                        @*------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------*@




                                        <div class="form-row">
                                            <div class="form-group col-md-12 text-center">
                                                <input type="submit" class="btn btn-primary" value="Update" />
                                                <button type="button" class="btn btn-info" data-toggle="modal" data-target="#TicketHistory">View History</button>
                                                <a href="@Url.Action("Ticket","Transaction")" class="btn btn-info">Cancel</a>
                                            </div>
                                        </div>



                                        <ul id="discussion" class="list-group">
                                        </ul>

                                    </div>


                                    </div>
                                    <!-- /.box -->
                                    <!-- /.box -->

                                </div>
                            </div>

                        </div>
                    }

                </div>
                @* <div id="chatApp">
                    <div class="container">
                        <div class="chat-container" id="chatContainer">
                            <!-- Chat messages will be loaded here -->
                        </div>
                        @using (Html.BeginForm("UploadCommunication", "Chat", FormMethod.Post, new { enctype = "multipart/form-data" }))
                        {
                            @Html.AntiForgeryToken()
                            <input type="hidden" id="ticketId" value="@Model.Id" name="TicketId" />
                            <input type="hidden" name="Username" value="@User.Identity.Name" />
                            <input type="hidden" name="EmailMessageId" value="@Model.EmailMessageId" />
                            <input type="hidden" id="Email_Subject_Hidden" name="Email_Subject" />
                            <div class="form-group">
                                <label for="CommunicationFile">Communication</label>
                                <input type="file" class="form-control" name="CommunicationFile" accept="image/*,video/*">
                            </div>
                            <div class="form-group">
                                <label for="CommunicationText">Message</label>
                                <textarea class="form-control" name="CommunicationText" placeholder="Enter text message"></textarea>
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">Send</button>
                            </div>
                            }
                        </div>
                            </div>

                *@
            </div>
        </div>
    </div>
</div>






<div class="modal fade bs-example-modal-lg" id="modal_FieldEngineer" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myLargeModalLabel">Field Engineer</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body table-responsive">

                <table class="table" id="FieldEngineer_Tic" style="max-height: 500px;max-width:100%;overflow: scroll;">
                    <tbody>
                        <tr class="thead-dark">
                            <th>Action</th>
                            <th>Name</th>
                            <th>Status</th>
                            <th>Remark</th>
                            <th>Status Sent On </th>
                            <th>FE Status Changed On </th>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer text-center">
                <button type="button" class="btn btn-info waves-effect " data-dismiss="modal">ok</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade bs-example-modal-lg" id="TicketHistory" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myLargeModalLabel">Ticket History </h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body">
                <div class="col-sm-12">
                    <div class="form-row">
                        <label for="example-text-input" class="col-sm-2 col-form-label Place">Ticket No:</label>
                        <div class="col-sm-3">
                            <input class="form-control" type="text" id="th_TicketNo" readonly>
                        </div>

                    </div>
                    <div class="form-row">
                        <label for="example-text-input" class="col-sm-2 col-form-label Place">Created By:</label>
                        <div class="col-sm-5">
                            <input class="form-control" type="text" id="th_CreatedBy" readonly>
                        </div>
                        <label for="example-text-input" class="col-sm-2 col-form-label Place">Created On:</label>
                        <div class="col-sm-3">
                            <input class="form-control" type="text" id="th_CreatedOn" readonly>
                        </div>

                    </div>

                    <div class="form-row">
                        <label for="example-text-input" class="col-sm-2 col-form-label Place">Comments:</label>
                        <div class="col-sm-10">
                            <textarea class="form-control" type="text" id="th_Comments" style="height:100%;" readonly></textarea>
                        </div>
                    </div>

                </div>
                <table class="table" id="Show" style="max-height: 500px;overflow: scroll;">
                    <tbody>
                        <tr class="thead-dark">
                            <th>Modified By</th>
                            <th>Modified On</th>
                            <th>Comments/Remark</th>
                            <th>Status</th>
                            <th id="th_SLA">SLA</th>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer text-center">
                <button type="button" class="btn btn-info waves-effect " data-dismiss="modal">ok</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade bs-example-modal-lg" id="modal_Pincode" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myLargeModalLabel">Pincode/Zipcode</h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            </div>
            <div class="modal-body table-responsive">

                <table class="table" id="FieldEngineer_PinZip" style="max-height: 500px;max-width:500px;overflow: scroll;">
                    <tbody>
                        <tr class="thead-dark">
                            <th>Pincode/Zipcode</th>
                            <th>City</th>
                            <th>State</th>
                            <th>Country</th>
                            <th>Action</th>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer text-center">
                <button type="button" class="btn btn-info waves-effect " data-dismiss="modal">ok</button>
            </div>
        </div>
    </div>
</div>



<div class="modal fade" id="myModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content text-center">
            <div class="modal-header">
                <h4 class="modal-title text-center"><i class="fa fa-info-circle" aria-hidden="true"></i> Information</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <ul>
                    @if (TempData["message"] != null)
                    {
                        var messages = TempData["message"] as List<string>;
                        if (messages != null)
                        {
                            foreach (var message in messages)
                            {
                                <li style="font-size: 20px;">@Html.Raw(message)</li>
                            }
                        }
                    }
                </ul>
            </div>
            <div class="modal-footer">
                <a href="#" data-dismiss="modal" aria-label="Close" class="btn btn-primary">OK</a>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<!-- EU model pop up for Status about FE HTML -->
<div class="modal fade" id="euStatusModal" tabindex="-1" role="dialog" aria-labelledby="euStatusModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="euStatusModalLabel">EU Status Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p><strong>Status:</strong> <span id="status"></span></p>
                <p><strong>Remark:</strong> <span id="Remark"></span></p>

                <p><strong>Sent:</strong> <span id="createdOn"></span></p>
                <p><strong>Modified:</strong> <span id="modifiedOn"></span></p>
                <p><strong>FE:</strong> <span id="feName"></span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>




<div class="modal fade" id="FEmyModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content  text-center">
            <div class="modal-header">
                <h4 class="modal-title text-center "><i class="fa fa-info-circle" aria-hidden="true"></i> Information</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="swal-icon swal-icon--error">
                    <div class="swal-icon--error__x-mark">
                        <span class="swal-icon--error__line swal-icon--error__line--left"></span>
                        <span class="swal-icon--error__line swal-icon--error__line--right"></span>
                    </div>
                </div>
                <p style="font-size: 20px;" id="FEerror"></p>

            </div>
            <div class="modal-footer">
                <!-- <button type="button" class="btn btn-primary">Save changes</button> -->

                <a href="#" data-dismiss="modal" aria-label="Close" class="btn btn-primary">OK</a>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<

@section scripts
{
    <script src="~/assets/js/moment.min.js"></script>
    <script src="~/assets/js/jsPages/jsEditTicket.js?v=<%= DateTime.Now.Ticks %>"></script>


    @if (TempData["message"] != null)
    {
        <script type="text/javascript">

            window.onload = function () {
                $('#myModal').modal('show');
                GoLocation();
            };
        </script>
    }
    else
    {
        <script type="text/javascript">
            window.onload = function () {

                GoLocation();
            };
        </script>
    }

    @*-----------------Chat initiation page--------------------------*@
    <script type="text/javascript">
   $(document).ready(function () {
       var ticketIdValue = $('#ticketId').val();
       var emailSubjectValue = $('#Email_Subject').val();

        // Handle initiate chat button click
        $('#initiateChatButton').click(function () {
            // Open chat window
            var url = '@Url.Action("ChatIndex", "Chat")' + '?ticketId=' + ticketIdValue;
            window.open(url, '_blank');
        });

        // Handle initiate chat button click
     $('#initiateChatwithSource').click(function () {
        // Open chat window without ticketId
        var url = '@Url.Action("ChatHdToSource", "Chat")';
        window.open(url, '_blank');
       });



        // Handle send email to customer button click
    $(document).ready(function () {

    $('#sendEmailToCustomerButton').click(function () {
        $.ajax({
            type: 'POST',
            url: '@Url.Action("SendChatInitiationEmail", "Chat")',
            data: {
                ticketId: ticketIdValue,
                emailSubject: emailSubjectValue
            },
            success: function (response) {
                if (response.success) {
                    alert('Chat initiation email sent successfully.');
                } else {
                    alert('Failed to send chat initiation email: ' + response.message);
                }
            },
            error: function (xhr, status, error) {
                alert('An error occurred: ' + error);
            }
                });
            });
    });
    @* --------------------Sening Response Email--------------------*@

    $('#sendResponseEmailToCustomerButton').click(function () {

        $.ajax({
            url: '@Url.Action("SendResponseLink", "Chat")',
            type: 'POST',
            data: {
                ticketId: ticketIdValue,
                emailSubject: emailSubjectValue
            },
            success: function(response) {
                alert('Email has been sent successfully!');
            },
            error: function(xhr, status, error) {
                alert('An error occurred while sending the email: ' + error);
            }
        });
    });

    });
    </script>
    @*-----------------Chat initiation page End--------------------------*@


    <script type="text/javascript">
        function clicked(item) {
            var id = $(item).attr("id");

            $("#FE").val($('#nam-' + id).val());
            $("#FE_ID").val($('#FEI-' + id).val());
        }

        function getFEMail(id){

            $.get(baseurl + "Transaction/getFEMail", { id:id,Ticket : @Model.Id}, function (data) {
                if (data.res == "Success") {


                    $('#FEerror').text('Email Sent to ' + data.fename);
                    $('#FEmyModal').modal('show');

                }
                else {
                    $('#FEerror').text('No FE Found in Master.');
                    $('#FEmyModal').modal('show');
                }

            });
        }

        function clickedon(item) {
            var id = $(item).attr("id");

            $("#City").val($('#city-' + id).val());
            $("#State").val($('#state-' + id).val());
            $("#Country").val($('#Country-' + id).val());

            var country = $('#Country-' + id).val();
            var code = $('#pin-' + id).val();

            getFEdetails(code, country);

        }



        $(document).ready(function () {

            $("#OEM").val("@Model.OEM");
            $("#Country").val("@Model.Country");
            $("#Status").val("@Model.Status");
            $("#Cancel_Reason").val("@Model.Cancel_Reason");
            @*$("#Other_Charge").val("@Model.Other_Charge");*@
            $("#Pregame").val("@Model.Pregame");
            $("#Part_Management").val("@Model.Part_Management");
            $("#Part_Handover").val("@Model.Part_Handover");
            $("#Ticket_Mode").val("@Model.Ticket_Mode");
            $("#Ticket_Type").val("@Model.Ticket_Type");
            $("#SLA").val("@Model.SLA");
            if ($("#SLA").is(":disabled")) {
                $("#HiddenSLA").val($("#SLA").val());
            }

            // Update hidden field value when SLA changes
            $("#SLA").change(function () {
                $("#HiddenSLA").val($(this).val());
            });

            $("#Certification_Need").val("@Model.Certification_Need");
            $("#Customer_Email_Send").val("@Model.Customer_Email");
            $("#FE_Email_Send").val("@Model.FE_Email");

            if (@Model.Part_Management == 22) {
                $(".pickup").css('display', 'block');
                $(".handover").css('display', 'none');

                if (@Model.Return_Label == 1) {
                    $(".pickup-av").css('display', 'block');
                    $(".pickup-nav").css('display', 'none');
                }
                else if (@Model.Return_Label == 0) {
                    $(".pickup-av").css('display', 'block');
                    $(".pickup-nav").css('display', 'block');
                }
                else
                {
                    $("#Return_Label option:selected").val("");
                    $(".pickup-av").css('display', 'none');
                    $(".pickup-nav").css('display', 'none');
                }

            }
            else if (@Model.Part_Management == 23) {
                $(".pickup").css('display', 'none');
                $(".handover").css('display', 'block');
                $(".pickup-av").css('display', 'none');
                $(".pickup-nav").css('display', 'none');
            }
            else
            {
                $(".pickup").css('display', 'none');
                $(".handover").css('display', 'none');
                $(".pickup-av").css('display', 'none');
                $(".pickup-nav").css('display', 'none');
            }

            if (@Model.Certification_Need == 1) {

                $(".cert").css('display', 'grid');
            }
            else {
                $(".cert").css('display', 'none');
            }


            if (@Model.Customer_Email == 1) {
                $(".customer-email").css('display', 'block');
            }
            else if (@Model.Customer_Email == 0) {
                $(".customer-email").css('display', 'none');
            }
            else
            {
                $("#Customer_Email_Send option:selected").val("");
                $(".customer-email").css('display', 'none');
            }


            if (@Model.FE_Email == 1) {
                $(".fe-email").css('display', 'block');

            }
            else if (@Model.FE_Email  == 0) {
                $(".fe-email").css('display', 'none');
                $("#FE_Email_Name").val('');
            }
            else
            {
                $("#FE_Email option:selected").val('');
                $(".fe-email").css('display', 'none');
                $("#FE_Email_Name").val('');
            }


            if ('@Model.Pregame' == '') {


            }
            else if('@Model.Pregame' == '1')
            {
                $(".pg").css('display', 'block');
            }
            else
            {
                $(".pg").css('display', 'none');
            }


            $.get(baseurl + "/Transaction/GetContact", { Cnt: @Model.EU_Office }, function (data) {

                if (data.res == "Success") {
                    $('#Office_contact tr').has('td').empty();

                    $.each(data.CC, function (i, val) {

                        $('#Office_contact tr:last').after('<tr><td> <input type="checkbox" name="customCheck_' + data.CC[i]['Id'] + '" class="form-control" id="customCheck_' + data.CC[i]['Id'] + '"  value="' + data.CC[i]['Email'] + '" style="width: 20px; height: 20px;"></td><td><span class="badge" style="font-size:100%;">'
                            + data.CC[i]['Person'] + " , " + data.CC[i]['Designation'] + '</span></td><td> <button type="button" title="edit" class="btn btn-link has-ripple" id=' + data.CC[i]['Id'] +
                                ' onclick="Contactfill(this.id)"><i class="fa fa-edit"></i></button> <button type="button" title="delete" class="btn btn-link has-ripple" id=' + data.CC[i]['Id'] +
                                ' onclick="Contactdelete(this.id)" style="margin-left:10%;"><i class="fa fa-trash"></i></button></td><tr>');
                    });

                    $("#Contact_ID").val(0);
                    $("#Person").val('');
                    $("#Designation").val('');
                    $("#Department").val('');
                    $("#CNumber").val('');
                    $("#CEmail").val('');

                } else {

                }
            });


            if(@Model.Is_Reschedule == 1)
            {
                $(".RDT").css('display', 'block');
                $(".TDR").css('display', 'none');
                $(".TCR").css('display', 'none');
                $("#Reschedule_DT").prop("required",true);
                $("#Decline_Reason").prop("required",false);
                $("#Cancel_Reason").prop("required",false);

            }



            $('#Certification').select2({
                multiple: true,
                placeholder: 'Add Certification Name...'
            });

            $('#Certification').val([@Model.Certification_Name]).trigger("change");

            $.get(baseurl + "Transaction/GetTicketHistory", { tn: @Model.Id }, function (data) {
                if (data.tv == "success") {
                    if (Object.keys(data.hist).length > 0) {

                        $.each(data.hist, function (i, val) {
                            $("#th_TicketNo").val(data.hist[i]['Ticket_No']);
                            $("#th_CreatedBy").val(data.hist[i]['CreatedBy']);
                            $("#th_CreatedOn").val(data.hist[i]['Createdon']);
                            $("#th_Comments").val(data.hist[i]['Remark']);
                            $("#th_Status").val(data.hist[i]['Status']);
                            $("#th_SLA").val(data.hist[i]['SLA']);

                            $('#Show tr:last').after('<tr><td>' + data.hist[i]['CreatedBy'] + '</td><td>' + data.hist[i]['Createdon'] + '</td><td>' + data.hist[i]['Remark'] + '</td><td>' + data.hist[i]['Status']+'</td><td>' + data.hist[i]['SLA'] + '</td></tr>');

                        });
                        $('#Show tr:last').remove();
                    }

                }
                else {
                }

            });





            $(document).on("click", ".classAdd", function () { //
                var rowCount = $('.data-contact-person').length + 1;
                var i = rowCount - 1;
                var contactdiv = '<tr class="data-contact-person">' +
                    '<td><input type="text" name="IV[' + i + '].Part_type" class="form-control f-name01" /></td>' +
                    '<td><input type="text" name="IV[' + i + '].Serial_No" class="form-control l-name01" /></td>' +
                    '<td><input type="text" name="IV[' + i + '].Make_Model" class="form-control email01" /></td>' +
                    '<td><input type="text" name="IV[' + i + '].Part_Description" class="form-control email02" /></td>' +
                    '<td><button type="button" id="btnAdd" class="btn btn-xs btn-primary classAdd"><i class="fas fa-plus-circle"></i></button>' +
                    '<button type="button" id="btnDelete" class="deleteContact btn btn btn-danger btn-xs"><i class="fas fa-minus-circle"></i></button></td>' +
                    '</tr>';
                $('#maintable').append(contactdiv); // Adding these controls to Main table class
            });

            $(document).on("click", ".deleteContact", function () {
                $(this).closest("tr").remove(); // closest used to remove the respective 'tr' in which I have my controls
            });


        });


        $(document).ready(function () {
            function handleStatusChange() {
                var status = $("#Status option:selected").val();

                // Hide all sections by default
                $("#totalResolutionTimeLocalContainer,#inTimeContainer,#chargesSentSection, #outTimeContainer, #chargesSectionContainer,#currencySectionContainer, .sc , .cl, .chin ,.RDT,.TDR ,.TCR ,.pg").css('display', 'none');

                switch (status) {
                    case '19': // Reschedule
                        $(".RDT").css('display', 'block');
                        break;

                    case '21': // Cancelled
                        $(".TCR").css('display', 'block');
                        break;

                    case '1362': // Declined
                        $(".TDR").css('display', 'block');
                        break;

                    case '1372': // Scheduled
                        $(".sc").css('display', 'block');
                        break;

                    case '1414': // FE Selected
                        $("#chargesSectionContainer").css('display', 'block');
                        $("#currencySectionContainer").css('display', 'block');
                        break;

                    case '2692': // Update Ticket Charges
                        $("#chargesSentSection").css('display', 'block');
                        $("#travelCharges").attr('required', true);
                        break;

                    case '1415': // Checked In
                        $("#inTimeContainer").css('display', 'block');
                        $("#inTime2ndFE").css('display', 'block');
                        break;

                    case '20': // Closed
                        $("#outTimeContainer").css('display', 'block');
                        $("#inTimeContainer").css('display', 'block');
                        $("#totalResolutionTimeLocalContainer").css('display', 'block');
                        $(".cl, .chin").css('display', 'block');
                        break;

                    case '1641': // Close and Reschedule
                        $("#outTimeContainer").css('display', 'block');
                        $("#inTimeContainer").css('display', 'block');
                        $(".RDT").css('display', 'block');
                        $("#totalResolutionTimeLocalContainer").css('display', 'block');
                        $(".chin").css('display', 'block');

                        break;

                    default:
                        // Keep all sections hidden
                        $("#travelCharges").removeAttr('required'); 
                        break;
                }
            }

            handleStatusChange();

            // Run when the Status dropdown changes
            $("#Status").change(handleStatusChange);
        });


        $("#Part_Management").change(function () {

            if ($("#Part_Management option:selected").val() == 22) {
                $(".pickup").css('display', 'block');
                $(".handover").css('display', 'none');
            }
            else if ($("#Part_Management option:selected").val() == 23) {
                $(".pickup").css('display', 'none');
                $(".handover").css('display', 'block');
                $(".pickup-av").css('display', 'none');
                $(".pickup-nav").css('display', 'none');
            }
            else
            {
                $(".pickup").css('display', 'none');
                $(".handover").css('display', 'none');
                $(".pickup-av").css('display', 'none');
                $(".pickup-nav").css('display', 'none');
            }
        });

        $("#Customer_Email_Send").change(function () {

            if ($("#Customer_Email_Send option:selected").val() == 1) {
                $(".customer-email").css('display', 'block');
            }
            else if ($("#Customer_Email_Send option:selected").val() == 0) {
                $(".customer-email").css('display', 'none');
            }
            else
            {
                $("#Customer_Email_Send option:selected").val("");
                $(".customer-email").css('display', 'none');
            }
        });

        $("#FE_Email_Send").change(function () {

            if ($("#FE_Email_Send option:selected").val() == 1) {
                $(".fe-email").css('display', 'block');
                $("#FE_Email_Name").val($("#FE_Email").val());

            }
            else if ($("#FE_Email option:selected").val() == 0) {
                $(".fe-email").css('display', 'none');
                $("#FE_Email_Name").val('');
            }
            else
            {
                $("#FE_Email option:selected").val('');
                $(".fe-email").css('display', 'none');
                $("#FE_Email_Name").val('');
            }
        });

        $("#Return_Label").change(function () {

            if ($("#Return_Label option:selected").val() == 1) {
                $(".pickup-av").css('display', 'block');
                $(".pickup-nav").css('display', 'none');
            }
            else if ($("#Return_Label option:selected").val() == 0) {
                $(".pickup-av").css('display', 'block');
                $(".pickup-nav").css('display', 'block');
            }
            else
            {
                $("#Return_Label option:selected").val("");
                $(".pickup-av").css('display', 'none');
                $(".pickup-nav").css('display', 'none');
            }
        });

        $("#FE_Part_Storage_Charge").change(function () {

            if ($("#FE_Part_Storage_Charge option:selected").val() == 1) {
                $(".fe-charge").css('display', 'block');
            }
            else if ($("#FE_Part_Storage_Charge option:selected").val() == 0) {
                $(".fe-charge").css('display', 'none');
            }
            else
            {
                $("#FE_Part_Storage_Charge option:selected").val("");
                $(".fe-charge").css('display', 'none');
            }
        });

        $("#Certification_Need").change(function () {

            if ($("#Certification_Need option:selected").val() == 1) {

                $(".cert").css('display', 'grid');
            }
            else {
                $(".cert").css('display', 'none');
            }
        });

        $("#Pregame").change(function () {

            if ($("#Pregame option:selected").val() == 1) {

                $(".pg").css('display', 'grid');
            }
            else {
                $(".pg").css('display', 'none');
            }
        });





        $('#FEStatus').click(function () {

            var code = @Model.Id
            $.get(baseurl + "/Transaction/GetFETicketStatus", { Ticket: code }, function (data) {

                if (data.res == "Success") {

                        $('#FieldEngineer_Tic tr').has('td').remove();
                        $.each(data.PZ, function (i, val) {

                            $('#FieldEngineer_Tic tr:last').after('<tr><td><button class="btn-fepop btn-info has-ripple" data-dismiss="modal" aria-label="Close"  onClick="getFEInfo(' + data.PZ[i]['FE_ID'] + ')" style="padding:none;"><i class="fas fa-check"></i></button></td><td>' + data.PZ[i]['Name'] + '</td> <td>' +
                                data.PZ[i]['Status'] + '</td><td>' + data.PZ[i]['Remark'] + '</td><td>' + data.PZ[i]['Sent'] + '</td><td>' + data.PZ[i]['Request'] + '</td><tr>');
                        });

                        $('#modal_FieldEngineer').modal('show');




                } else {

                }
            });

        });
    </script>

    <script>
    var marker = []; // Initialize marker array globally
    var clickedInfoWindows = []; // Initialize clickedInfoWindows array globally
    var data = []; // Store the FE data globally for search functionality

function GoLocation() {
    // Initialize the map centered on the given latitude and longitude
    map = new google.maps.Map(document.getElementById('map_canvas'), {
        zoom: 14, // Adjust the initial zoom level as needed
        mapTypeId: 'roadmap',
        center: { lat: @Model.latitude, lng: @Model.longitude }
    });

    // Make an AJAX call to fetch Field Engineer details and place markers
    $.get("@Url.Action("getFEdetailsMap", "Transaction", new { id = Model.Id })", function (responseData, status) {
        data = responseData; // Store the fetched data for global use

        displayMarkers(data); // Call a function to handle displaying the markers

        // Add event listeners for search functionality
        $('#searchFE').on('keyup blur', function () {
            var searchValue = $(this).val().toLowerCase();
            var filteredData = data.filter(function (fe) {
                // Check if Email is valid before calling toLowerCase()
                return fe.Email && fe.Email.toLowerCase().includes(searchValue);
            });

            if (filteredData.length > 0) {
                // If there's a matching FE, re-center the map to the first match
                var firstLatLng = new google.maps.LatLng(filteredData[0].latitude, filteredData[0].longitude);
                map.setCenter(firstLatLng); // Center the map to the first matching FE
                map.setZoom(15); // Optionally adjust the zoom level
            }

            displayMarkers(filteredData); // Call the function to update the markers based on search
        });
    });
}

function displayMarkers(feData) {
    // Clear existing markers and infowindows
    if (marker.length) {
        for (var i = 0; i < marker.length; i++) {
            if (marker[i]) marker[i].setMap(null);
        }
        marker = [];
    }

    if (clickedInfoWindows.length) {
        for (var i = 0; i < clickedInfoWindows.length; i++) {
            if (clickedInfoWindows[i]) clickedInfoWindows[i].close();
        }
        clickedInfoWindows = [];
    }

    var iconName;
    var directionsService = new google.maps.DirectionsService();
    var directionsRenderer = [];

    // Get the origin coordinates from input fields
    var originLat = parseFloat($('#latitude').val());
    var originLng = parseFloat($('#longitude').val());
    var origin = new google.maps.LatLng(originLat, originLng);

    // Loop through the filtered data to create markers and infowindows
    for (var i = 0; i < feData.length; i++) {
        var latLng, destination;

        // Set the icon based on the type of Field Engineer
        if (feData[i].Type == 'FE') {
            latLng = new google.maps.LatLng(feData[i].latitude, feData[i].longitude);
            iconName = "/icon/icon-fe.png";
        } else if (feData[i].Type == 'FE_Rej') {
            latLng = new google.maps.LatLng(feData[i].latitude, feData[i].longitude);
            iconName = "/icon/icon-fe-rej.png";
        } else if (feData[i].Type == 'FE_Cert') {
            latLng = new google.maps.LatLng(feData[i].latitude, feData[i].longitude);
            iconName = "/icon/icon-fe-cert.png";
        } else if (feData[i].Type == 'FE_Deactive') {
            latLng = new google.maps.LatLng(feData[i].latitude, feData[i].longitude);
            iconName = "/icon/icon-fe-rej.png";
        } else if (feData[i].Type == 'FE_Blacklist') {
            latLng = new google.maps.LatLng(feData[i].latitude, feData[i].longitude);
            iconName = "/icon/icon-fe-blacklist.png";
        } else {
            latLng = new google.maps.LatLng(feData[i].latitude, feData[i].longitude);
            iconName = "/icon/icon-eu.png";
        }

        destination = new google.maps.LatLng(feData[i].latitude, feData[i].longitude);
        var contentString = '<div id="content_' + feData[i].FE_ID + '" style="width:350px;">' +
            '<h3 id="FEHeading_' + feData[i].FE_ID + '" style="text-align: center;color: #505050;">' + feData[i].FE_Name + '</h3>' +
            '<div id="bodyContent_' + feData[i].FE_ID + '">' +
            '<label id="Status_' + feData[i].FE_ID + '"> <b> FE Status : </b> ' + feData[i].Status + '</label><br/>' +
            '<label id="Address_' + feData[i].FE_ID + '"> <b> FE Origin : </b> ' + feData[i].FE_Origin + '</label><br/>' +
            '<label id="Phone_' + feData[i].FE_ID + '"> <b> FE Phone : </b> ' + feData[i].Phone + '</label><br/>' +
            '<label id="Email_' + feData[i].FE_ID + '"> <b> FE Email : </b> ' + feData[i].Email + '</label><br/>' +
            '<label id="ManagerName_' + feData[i].FE_ID + '"> <b> Manager Name : </b> ' + feData[i].Manager_Name + '</label><br/>' +
            '<label id="ManagerPhone_' + feData[i].FE_ID + '"> <b> Manager Contact: </b> ' + feData[i].Manager_Phone_Number + '</label><br/>' +
            '<label id="CBH_' + feData[i].FE_ID + '"> <b> FE Charges Per Business Hour : </b> ' + feData[i].Charges_Business_Hour + '</label><br/>' +
            '<label id="CNBH_' + feData[i].FE_ID + '"> <b> FE Charges Per Non Business Hour : </b> ' + feData[i].Charges_Non_Business_Hour + '</label><br/>' +
            '<label id="CJ_' + feData[i].FE_ID + '"> <b> FE Charges Per Job : </b> ' + feData[i].Charge_Job + '</label><br/>' +
            '<div style="margin-top: 10px;">' +
            '<input type="button" class="btn btn-info has-ripple" value="Select This FE" onClick="getFEInfo(' + feData[i].FE_ID + ', 1)" style="display: block; width: 100%; margin-bottom: 10px;">' +
            '<input type="button" class="btn btn-secondary has-ripple" value="Select This FE for Second" onClick="getFEInfo(' + feData[i].FE_ID + ', 2)" style="display: block; width: 100%; margin-bottom: 10px;">' +
            '<input type="button" class="btn btn-primary has-ripple" value="Send Details" onClick="getFEMail(' + feData[i].FE_ID + ')" style="display: block; width: 100%;">' +
            '</div>' +
            '</div>';

        // Create a marker and store it in the global marker array
        marker[i] = new google.maps.Marker({
            position: latLng,
            map: map,
            icon: iconName
        });

        directionsRenderer[i] = new google.maps.DirectionsRenderer({
            map: map,
            suppressMarkers: true
        });

        (function (i, origin, destination, contentString) {
            var currentZoom = map.getZoom(); // Store the current zoom level
            var currentCenter = map.getCenter(); // Store the current center of the map

            // Function to display the InfoWindow without zooming out
            function showInfoWindow(infoWindow) {
                infoWindow.setContent(contentString);

                var request = {
                    origin: origin,
                    destination: destination,
                    travelMode: 'DRIVING'
                };

                directionsService.route(request, function (result, status) {
                    if (status == 'OK') {
                        directionsRenderer[i].setDirections(result);
                        var route = result.routes[0].legs[0];
                        var distance = route.distance.text;
                        var duration = route.duration.text;

                        // Append distance and duration to the contentString
                        var updatedContentString = contentString +
                            '<div style="text-align: center; margin-top: 10px; color: #007bff; font-weight: bold;">' +
                            '<b>Distance:</b> ' + distance + '<br/>' +
                            '<b>Duration:</b> ' + duration +
                            '</div>';

                        infoWindow.setContent(updatedContentString);
                    }
                    infoWindow.open(map, marker[i]);
                });
            }

            // Click event for marker
            google.maps.event.addListener(marker[i], 'click', function () {
                // Store the current zoom level and center of the map
                var currentZoom = map.getZoom();
                var currentCenter = map.getCenter();

                var clickInfoWindow = new google.maps.InfoWindow({
                    disableAutoPan: true, // Prevent auto-panning on click
                    maxWidth: 350 // Optional: Set maximum width for the info window
                });

                clickedInfoWindows.push(clickInfoWindow); // Track opened InfoWindows
                showInfoWindow(clickInfoWindow); // Show the InfoWindow with marker details

                // Reapply the current zoom level and center after a small delay
                setTimeout(function () {
                    map.setZoom(currentZoom); // Maintain the current zoom level
                    map.setCenter(currentCenter); // Maintain the current map center
                }, 100); // Small delay to override any default behavior
            });

        })(i, origin, destination, contentString);
    }
}

function geocode() {
    var location = $('#Street_Address').val();

    axios.get('https://maps.googleapis.com/maps/api/geocode/json', {
        params: {
            address: location,
        }
    })
    .then(function (response) {
        var formattedAddress = response.data.results[0].formatted_address;
        var lat = response.data.results[0].geometry.location.lat;
        var lng = response.data.results[0].geometry.location.lng;

        $('#latitude').val(lat);
        $('#longitude').val(lng);

        var myLatlng = new google.maps.LatLng(lat, lng);
        var geocoder = new google.maps.Geocoder();
        var mapOptions = {
            zoom: 18,
            center: myLatlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        map = new google.maps.Map(document.getElementById("myMap"), mapOptions);

        var marker = new google.maps.Marker({
            map: map,
            position: myLatlng,
            draggable: true
        });

        geocoder.geocode({ 'latLng': myLatlng }, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                if (results[0]) {
                    $('#latitude,#longitude').show();
                    $('#latitude').val(marker.getPosition().lat());
                    $('#longitude').val(marker.getPosition().lng());
                    var address = results[0].address_components;
                    $('#ZipCode_Pincode').val(address[address.length - 1].long_name);
                    $('#City').val(address[address.length - 4].long_name);
                    $('#State').val(address[address.length - 3].long_name);
                    $('#Country').val(address[address.length - 2].long_name);
                    hoverInfoWindow.setContent(results[0].formatted_address);
                    hoverInfoWindow.open(map, marker);
                }
            }
        });

        google.maps.event.addListener(marker, 'dragend', function () {
            geocoder.geocode({ 'latLng': marker.getPosition() }, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    if (results[0]) {
                        $('#latitude').val(marker.getPosition().lat());
                        $('#longitude').val(marker.getPosition().lng());
                        var address = results[0].address_components;
                        $('#ZipCode_Pincode').val(address[address.length - 1].long_name);
                        $('#City').val(address[address.length - 4].long_name);
                        $('#State').val(address[address.length - 3].long_name);
                        $('#Country').val(address[address.length - 2].long_name);
                        hoverInfoWindow.setContent(results[0].formatted_address);
                        hoverInfoWindow.open(map, marker);
                    }
                }
            });
        });
    })
    .catch(function (error) {
        console.log(error);
    });
}

    </script>

    <script>
        $(document).ready(function () {
            let tseCount = 1; // Initialize tseCount to 1

            // Check if TSE_Name2 or TSE_Name3 have values to initialize tseCount
            if ($('#TSE_Name3').length && $('#TSE_Name3').val()) {
                tseCount = 3;
            } else if ($('#TSE_Name2').length && $('#TSE_Name2').val()) {
                tseCount = 2;
            }

            $('#addTSEField').on('click', function () {
                if (tseCount < 3) { // Allow adding up to 3 TSE fields
                    tseCount++;
                    let tseHtml = '';

                    if (tseCount === 2) {
                        tseHtml = `
                                                                            <div class="form-row mb-3" id="TSENameField2">
                                                                                <label for="TSE_Name2" class="col-sm-2 col-form-label">
                                                                                    <i class="fas fa-user-tie"></i> TSE Name 2
                                                                                </label>
                                                                                <div class="col-md-4">
                                                                                    <input type="text" class="form-control" name="TSE_Name2" id="TSE_Name2" placeholder="Enter TSE Name 2">
                                                                                </div>
                                                                            </div>`;
                    } else if (tseCount === 3) {
                        tseHtml = `
                                                                            <div class="form-row mb-3" id="TSENameField3">
                                                                                <label for="TSE_Name3" class="col-sm-2 col-form-label">
                                                                                    <i class="fas fa-user-tie"></i> TSE Name 3
                                                                                </label>
                                                                                <div class="col-md-4">
                                                                                    <input type="text" class="form-control" name="TSE_Name3" id="TSE_Name3" placeholder="Enter TSE Name 3">
                                                                                </div>
                                                                            </div>`;
                    }

                    $('#TSENameContainer').append(tseHtml);
                }

                if (tseCount === 3) {
                    $('#addTSEField').prop('disabled', true); // Disable the add button after 3 fields
                }
            });
        });
    </script>

    <script>


        //function Contactfill(id) {

        //    $.get(baseurl + "/Master/GetContact", { Id: id }, function (data) {

        //        if (data.res == "Success") {
        //            $("#Contact_ID").val(data.CC['Id']);
        //            $("#Person").val(data.CC['Person']);
        //            $("#Designation").val(data.CC['Designation']);
        //            $("#Department").val(data.CC['Department']);
        //            $("#CNumber").val(data.CC['Number']);
        //            $("#CEmail").val(data.CC['Email']);
        //            $("#Contact_btn").val('Update');
        //            $("#Contact_add").css('display', 'unset');
        //        }
        //        else {

        //        }
        //    });
        //}

        //function Contactdelete(id) {

        //    var code = $("#Office").val();
        //    $("#loadermodel").css('display', 'unset');
        //    $.get(baseurl + "/Transaction/deleteContact", { OC: id }, function (data) { });


        //    $.get(baseurl + "/Transaction/GetContact", { Cnt: code }, function (data) {

        //        if (data.res == "Success") {
        //            $('#Office_contact tr').has('td').empty();

        //            $.each(data.CC, function (i, val) {

        //                $('#Office_contact tr:last').after('<tr><td> <input type="checkbox" name="customCheck_' + data.CC[i]['Id'] + '" class="form-control" id="customCheck_' + data.CC[i]['Id'] + '"  value="' + data.CC[i]['Email'] + '" style="width: 20px; height: 20px;"></td><td><span class="badge" style="font-size:100%;">'
        //                    + data.CC[i]['Person'] + " , " + data.CC[i]['Designation'] + '</span></td><td> <button type="button" title="edit" class="btn btn-link has-ripple" id=' + data.CC[i]['Id'] +
        //                        ' onclick="Contactfill(this.id)"><i class="fa fa-edit"></i></button> <button type="button" title="delete" class="btn btn-link has-ripple" id=' + data.CC[i]['Id'] +
        //                        ' onclick="Contactdelete(this.id)" style="margin-left:10%;"><i class="fa fa-trash"></i></button></td><tr>');
        //            });

        //            $("#Contact_ID").val(0);
        //            $("#Person").val('');
        //            $("#Designation").val('');
        //            $("#Department").val('');
        //            $("#CNumber").val('');
        //            $("#CEmail").val('');

        //        } else {

        //        }
        //    });



        //    $("#loadermodel").css('display', 'none');
        //}


        //$("#Contact_btn").click(function () {
        //    $("#loadermodel").css('display', 'unset');
        //    var code = $("#Office").val();

        //    $.get(baseurl + "/Transaction/ContactEUMaster", {
        //        Office_ID: $("#Office").val(), Person: $("#Person").val(),
        //        Designation: $("#Designation").val(), Department: $("#Department").val(), Number: $("#CNumber").val(), Email: $("#CEmail").val(),
        //        Contact_ID: $("#Contact_ID").val()
        //    }, function (data) { });

        //    $.get(baseurl + "/Transaction/GetContact", { Cnt: code }, function (data) {

        //        if (data.res == "Success") {
        //            $('#Office_contact tr').has('td').empty();

        //            $.each(data.CC, function (i, val) {

        //                $('#Office_contact tr:last').after('<tr><td> <input type="checkbox" name="customCheck_' + data.CC[i]['Id'] + '" class="form-control" id="customCheck_' + data.CC[i]['Id'] + '"  value="' + data.CC[i]['Email'] + '" style="width: 20px; height: 20px;"></td><td><span class="badge" style="font-size:100%;">'
        //                    + data.CC[i]['Person'] + " , " + data.CC[i]['Designation'] + '</span></td><td> <button type="button" title="edit" class="btn btn-link has-ripple" id=' + data.CC[i]['Id'] +
        //                        ' onclick="Contactfill(this.id)"><i class="fa fa-edit"></i></button> <button type="button" title="delete" class="btn btn-link has-ripple" id=' + data.CC[i]['Id'] +
        //                        ' onclick="Contactdelete(this.id)" style="margin-left:10%;"><i class="fa fa-trash"></i></button></td><tr>');
        //            });
        //            $("#Contact_ID").val(0);
        //            $("#Person").val('');
        //            $("#Designation").val('');
        //            $("#Department").val('');
        //            $("#CNumber").val('');
        //            $("#CEmail").val('');

        //        } else {

        //        }
        //    });
        //    $("#loadermodel").css('display', 'none');
        //});


        //$("#Contact_add").click(function () {
        //    $("#Contact_ID").val(0);
        //    $("#Person").val('');
        //    $("#Designation").val('');
        //    $("#Department").val('');
        //    $("#CNumber").val('');
        //    $("#CEmail").val('');
        //    $("#Contact_btn").val('Add');
        //    $("#Contact_add").css('display', 'none');
        //});

        //$('#save_value').click(function () {

        //    var val = [];
        //    $(':checkbox:checked').each(function (i) {
        //        val[i] = $(this).val();
        //    });
        //    $('#email_office').val(val);

        //});
    </script>
    @*<script>
        $(document).ready(function () {
            var ticketIdValue = $('#ticketId').val();
            var lastMessageId = 0; // Track the ID of the last message

            function fetchCommunications() {
                $.ajax({
                    url: '@Url.Action("GetCommunications", "Chat")',
                    type: 'GET',
                    data: { ticketId: ticketIdValue },
                    success: function (data) {
                        if (Array.isArray(data)) {
                            var chatContainer = $('#chatContainer');
                            chatContainer.empty();
                            data.forEach(function (message) {
                                appendMessage(message, chatContainer);
                                if (message.Id > lastMessageId) {
                                    lastMessageId = message.Id;
                                }
                            });
                        } else {
                            console.error('Returned data is not an array:', data);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('An error occurred while fetching communications:', error);
                    }
                });
            }

            function appendMessage(message, chatContainer) {
                var messageElement = $('<div class="chat-message"></div>');
                messageElement.addClass(message.Username === 'Source' ? 'left' : 'right');
                if (message.MessageText) {
                    messageElement.append('<p>' + message.MessageText + '</p>');
                }
                if (message.FilePath) {
                    if (message.FileType.startsWith('image/')) {
                        messageElement.append('<img src="' + message.FilePath + '" />');
                    } else if (message.FileType.startsWith('video/')) {
                        messageElement.append('<video controls src="' + message.FilePath + '"></video>');
                    }
                }
                messageElement.append('<small>' + formatTimestamp(message.CreatedAt) + '</small>');
                chatContainer.append(messageElement);
            }

            function formatTimestamp(timestamp) {
                return moment(timestamp).format('YYYY-MM-DD HH:mm:ss');
            }

            function checkForNewMessages() {
                $.ajax({
                    url: '@Url.Action("GetCommunications", "Chat")',
                    type: 'GET',
                    data: { ticketId: ticketIdValue },
                    success: function (data) {
                        if (Array.isArray(data)) {
                            var chatContainer = $('#chatContainer');
                            data.forEach(function (message) {
                                if (message.Id > lastMessageId) {
                                    appendMessage(message, chatContainer);
                                    if (message.Username === 'Source') {
                                        playNotification();
                                    }
                                    lastMessageId = message.Id;
                                }
                            });
                        } else {
                            console.error('Returned data is not an array:', data);
                        }
                    },
                    error: function (xhr, status, error) {
                        console.error('An error occurred while checking for new communications:', error);
                    }
                });
            }

            function playNotification() {
                var audio = new Audio('@Url.Content("~/assets/audio/mixkit-happy-bells-notification-937.wav")');
                audio.play();
            }

            fetchCommunications(); // Initial fetch
          //  setInterval(checkForNewMessages, 50000); // Check for new messages every 5 seconds
        });
        </script>*@
    @*==============================================================================================================================================================================================================*@
}
